<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Chapter 22. Hosting a Microsoft Distributed File System tree on Samba</title><link rel="stylesheet" href="samba.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.59.1"><link rel="home" href="index.html" title="SAMBA Project Documentation"><link rel="up" href="optional.html" title="Part III. Advanced Configuration"><link rel="previous" href="VFS.html" title="Chapter 21. Stackable VFS modules"><link rel="next" href="integrate-ms-networks.html" title="Chapter 23. Integrating MS Windows networks with Samba"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 22. Hosting a Microsoft Distributed File System tree on Samba</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="VFS.html">Prev</a> </td><th width="60%" align="center">Part III. Advanced Configuration</th><td width="20%" align="right"> <a accesskey="n" href="integrate-ms-networks.html">Next</a></td></tr></table><hr></div><div class="chapter" lang="en"><div class="titlepage"><div><h2 class="title"><a name="msdfs"></a>Chapter 22. Hosting a Microsoft Distributed File System tree on Samba</h2></div><div><div class="author"><h3 class="author">Shirish Kalele</h3><div class="affiliation"><span class="orgname">Samba Team &amp; Veritas Software<br></span><div class="address"><p><br>
				<tt>&lt;<a href="mailto:samba@samba.org">samba@samba.org</a>&gt;</tt><br>
			</p></div></div></div></div><div><p class="pubdate">12 Jul 2000</p></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><a href="msdfs.html#id2899111">Instructions</a></dt><dd><dl><dt><a href="msdfs.html#id2899858">Notes</a></dt></dl></dd></dl></div><div class="sect1" lang="en"><div class="titlepage"><div><h2 class="title" style="clear: both"><a name="id2899111"></a>Instructions</h2></div></div><p>The Distributed File System (or Dfs) provides a means of 
	separating the logical view of files and directories that users 
	see from the actual physical locations of these resources on the 
	network. It allows for higher availability, smoother storage expansion, 
	load balancing etc. For more information about Dfs, refer to  <a href="http://www.microsoft.com/NTServer/nts/downloads/winfeatures/NTSDistrFile/AdminGuide.asp" target="_top">
	Microsoft documentation</a>. </p><p>This document explains how to host a Dfs tree on a Unix 
	machine (for Dfs-aware clients to browse) using Samba.</p><p>To enable SMB-based DFS for Samba, configure it with the 
	<i><tt>--with-msdfs</tt></i> option. Once built, a 
	Samba server can be made a Dfs server by setting the global 
	boolean <a href="smb.conf.5.html#HOSTMSDFS" target="_top"><i><tt>
	host msdfs</tt></i></a> parameter in the <tt>smb.conf
	</tt> file. You designate a share as a Dfs root using the share 
	level boolean <a href="smb.conf.5.html#MSDFSROOT" target="_top"><i><tt>
	msdfs root</tt></i></a> parameter. A Dfs root directory on 
	Samba hosts Dfs links in the form of symbolic links that point 
	to other servers. For example, a symbolic link
	<tt>junction-&gt;msdfs:storage1\share1</tt> in 
	the share directory acts as the Dfs junction. When Dfs-aware 
	clients attempt to access the junction link, they are redirected 
	to the storage location (in this case, \\storage1\share1).</p><p>Dfs trees on Samba work with all Dfs-aware clients ranging 
	from Windows 95 to 2000.</p><p>Here's an example of setting up a Dfs tree on a Samba 
	server.</p><pre class="programlisting">
# The smb.conf file:
[global]
	netbios name = SAMBA
	host msdfs   = yes

[dfs]
	path = /export/dfsroot
	msdfs root = yes
	</pre><p>In the /export/dfsroot directory we set up our dfs links to 
	other servers on the network.</p><p><tt>root# </tt><b><tt>cd /export/dfsroot</tt></b></p><p><tt>root# </tt><b><tt>chown root /export/dfsroot</tt></b></p><p><tt>root# </tt><b><tt>chmod 755 /export/dfsroot</tt></b></p><p><tt>root# </tt><b><tt>ln -s msdfs:storageA\\shareA linka</tt></b></p><p><tt>root# </tt><b><tt>ln -s msdfs:serverB\\share,serverC\\share linkb</tt></b></p><p>You should set up the permissions and ownership of 
	the directory acting as the Dfs root such that only designated 
	users can create, delete or modify the msdfs links. Also note 
	that symlink names should be all lowercase. This limitation exists 
	to have Samba avoid trying all the case combinations to get at 
	the link name. Finally set up the symbolic links to point to the 
	network shares you want, and start Samba.</p><p>Users on Dfs-aware clients can now browse the Dfs tree 
	on the Samba server at \\samba\dfs. Accessing 
	links linka or linkb (which appear as directories to the client) 
	takes users directly to the appropriate shares on the network.</p><div class="sect2" lang="en"><div class="titlepage"><div><h3 class="title"><a name="id2899858"></a>Notes</h3></div></div><div class="itemizedlist"><ul type="disc"><li><p>Windows clients need to be rebooted 
			if a previously mounted non-dfs share is made a dfs 
			root or vice versa. A better way is to introduce a 
			new share and make it the dfs root.</p></li><li><p>Currently there's a restriction that msdfs 
			symlink names should all be lowercase.</p></li><li><p>For security purposes, the directory 
			acting as the root of the Dfs tree should have ownership 
			and permissions set so that only designated users can 
			modify the symbolic links in the directory.</p></li></ul></div></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="VFS.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="optional.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="integrate-ms-networks.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 21. Stackable VFS modules </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 23. Integrating MS Windows networks with Samba</td></tr></table></div></body></html>
