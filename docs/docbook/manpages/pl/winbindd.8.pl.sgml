<!DOCTYPE refentry PUBLIC "-//OASIS//DTD DocBook V4.1//EN">
<refentry id="winbindd" lang="pl">

<refmeta>
    <refentrytitle>winbindd</refentrytitle>
    <manvolnum>8</manvolnum>
</refmeta>


<refnamediv>
    <refname>winbindd</refname>
    <refpurpose>Demon Prze³±czania Us³ug Nazewniczych (Name Service
      Switch) do odwzorowania nazw z serwerów NT</refpurpose>
</refnamediv>

<refsynopsisdiv>
    <cmdsynopsis>
      <command>winbindd</command>
      <arg choice="opt">-i</arg>
      <arg choice="opt">-d &lt;poziom debugowania&gt;</arg>
      <arg choice="opt">-s &lt;plik konfiguracyjny smb&gt;</arg>
    </cmdsynopsis>
</refsynopsisdiv>

<refsect1>
    <title>OPIS</title>

    <para>Ten program jest czê¶ci± pakietu <ulink url="samba.7.html">
	Samba</ulink>.</para>

    <para><command>winbindd</command> jest demonem który dostarcza
      us³ug do funkcjonalno¶ci Prze³±cznika Us³ug Nazewniczych
      (Name Service Switch - dalej u¿yta jest oryginalna nazwa, przyp.t³um.)
      który jest obecny w wiêkszo¶ci nowych bibliotek C. Name
      Service Switch pozwala na uzyskanie informacji u¿ytkownika
      i systemu z ró¿nych us³ug bazodanowych, takich jak NIS lub
      DNS. Dok³adne zachowanie mo¿e byæ skonfigurowane poprzez
      plik <filename>/etc/nsswitch.conf</filename>. U¿ytkownicy
      i grupy s± alokowani, gdy tylko zostan± odwzorowani w obrêbie
      zakresu identyfikatorów u¿ytkowników i grup okre¶lonego
      przez administratora systemu Samba.</para>

    <para>Us³uga dostarczana przez winbindd nazywa siê "winbind"
      i mo¿e byæ u¿yta do odwzorowania danych u¿ytkownika i grupy
      z serwera Windows NT. Mo¿e równie¿ dostarczyæ us³ug
      autentykacyjnych poprzez przypisany modu³ PAM.</para>

    <para>Nastêpuj±ce bazy danych nsswitch s± implementowane przez
      us³ugê winbind: </para>

    <variablelist>
      <varlistentry>
	<term>passwd</term>
	<listitem><para>Dane u¿ytkownika tradycyjnie przechowywane
	    w pliku <filename>passwd(5)</filename> i u¿ywane przez
	    funkcje <command>getpwent(3)</command>.</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>group</term>
	<listitem><para>Dane grup tradycyjnie przechowywane w pliku
	    <filename>group(5)</filename> i u¿ywane przez funkcje
	    <command>getgrent(3)</command>.</para></listitem>
      </varlistentry>
    </variablelist>

    <para>Na przyk³ad, poni¿sza prosta konfiguracja w pliku <filename>
	/etc/nsswitch.conf</filename> mo¿e byæ u¿yta do odwzorowania
      danych u¿ytkowników i grup najpierw z <filename>/etc/passwd
      </filename> i <filename>/etc/group</filename>, a potem z serwera
      Windows NT.</para>

    <para><programlisting>
passwd:         files winbind
group:          files winbind
    </programlisting></para>
</refsect1>

<refsect1>
    <title>OPCJE</title>

    <variablelist>
      <varlistentry>
	<term>-d poziomdebugowania</term>
	<listitem><para>Ustawia poziom debugowania na warto¶æ ca³kowit±
	    pomiêdzy 0 i 100. 0 odpowiada brakowi debugowania, a 100
	    odpowiada (?)absolutnym detalom(?). Aby wys³aæ raport o
	    b³êdach do Zespo³u Samba, u¿yj poziomu 100 (zobacz
	    plik <filename>BUGS.txt</filename>).</para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>-i</term>
	<listitem><para>Mówi <command>winbindd</command> ¿eby nie
	    zostawa³ demonem i nie od³±cza³ siê od bie¿±cego terminala.
	    Ta opcja jest u¿ywana przez developerów podczas
	    interaktywnego debugowania <command>winbindd</command> je¶li
	    jest to wymagane.</para></listitem>
      </varlistentry>
    </variablelist>
</refsect1>

<refsect1>
    <title>ODWZOROWANIE ID I NAZWY</title>

    <para>U¿ytkownicy i grupy w serwerze Windows NT s± skojarzeni z
      identyfikatorem relatywnym (rid) który jest unikalny dla domeny
      gdy u¿ytkownik lub grupa s± tworzeni. ¯eby konwertowaæ
      u¿ytkownika lub grupê Windows NT na u¿ytkownika lub grupê unix,
      wymagane jest odwzorowanie pomiêdzy rid'ami a identyfikatorami
      u¿ytkownika lub grupy unix. Jest to jedno z zadañ które wykonuje
      <command>winbindd</command>.</para>

    <para>Jak tylko u¿ytkownicy i grupy winbindd s± odwzorowywani
      przez serwer, identyfikatory u¿ytkowników i grup s± alokowane
      z okre¶lonego przedzia³u. Jest to wykonywane przy pierwszym
      podej¶ciu, oparte o serwer, choæ wszyscy istniej±cy u¿ytkownicy
      i grupy bêd± mapowani gdy tylko klient przeprowadzi enumeracjê
      u¿ytkowników lub grup. Zaalokowane identyfikatory unix bêd±
      przechowywane w pliku bazy danych w katalogu blokad (lock) Samba
      i bêd± zapamiêtane.</para>

    <para><emphasis>OSTRZE¯ENIE:</emphasis>: Baza danych "rid na unix
      id" jest jedynym miejscem, gdzie odwzorowania u¿ytkowników i
      grup s± przechowywane przez winbindd. Je¶li ten plik zostanie
      usuniêty lub uszkodzony, nie bêdzie ¿adnego sposobu ¿eby
      winbindd okre¶li³, które identyfikatory u¿ytkowników i grup
      odpowiadaj± którym rid'om u¿ytkowników i grup Windows NT.</para>
</refsect1>

<refsect1>
    <title>KONFIGURACJA</title>

    <para>Konfiguracja demona <command>winbindd</command> jest
      wykonywana przez parametry konfiguracyjne w pliku <filename>
	smb.conf(5)</filename>. Wszystkie parametry powinny byæ
      okre¶lone w sekcji [global] smb.conf.</para>

    <variablelist>
      <varlistentry>
	<term>winbind separator</term>
	<listitem><para>Opcja separatora winbind pozwala ci okre¶liæ
	    jak nazwy domen NT i u¿ytkowników s± ³±czone w nazwê
	    u¿ytkownika unix gdy jest ona prezentowana u¿ytkownikom.
	    Domy¶lnie, <command>winbindd</command> bêdzie u¿ywa³
	    tradycyjnego separatora '\' tak, ¿e nazwa u¿ytkownika
	    unix bêdzie wygl±da³a jak DOMENA\nazwauzytkownika.
	    W niektórych przypadkach ten znak mo¿e powodowaæ problemy,
	    bo znak '\' ma specjalne znaczenie w pow³okach unix.
	    W takim wypadku mo¿esz u¿yæ opcji separatora winbind, aby
	    okre¶liæ alternatywny znak separatora. Dobrymi
	    alternatywami mog± byæ '/' (aczkolwiek to konfliktuje
	    z separatorem katalogów unix) lub '+'. Znak '+' wydaje
	    siê byæ najlepszym wyborem dla 100% kompatybilno¶ci
	    z istniej±cymi narzêdziami unix, lecz mo¿e byæ z³ym
	    wyborem z estetycznego punktu widzenia, zale¿nie od twojego
	    gustu.</para>

	  <para>Domy¶lnie: <command>winbind separator = \ </command>
	    </para>
	  <para>Przyk³ad: <command>winbind separator = + </command>
	    </para>
	  </listitem>
      </varlistentry>

      <varlistentry>
	<term>winbind uid</term>
	<listitem><para>Parametr winbind uid okre¶la zakres
	    identyfikatorów u¿ytkowników które s± alokowane przez
	    demona winbind. Zakres ten nie powinien zawieraæ istniej±cych
	    u¿ytkowników lokalnych lub nis, bo w przeciwnym wypadku
	    mog± wyst±piæ dziwne konflikty.</para>

	  <para>Domy¶lnie: <command>winbind uid = &lt;pusty ³añcuch znakowy&gt;
	      </command></para>
	  <para>Przyk³ad: <command>winbind uid = 10000-20000</command>
	    </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>winbind gid</term>
	<listitem><para>Parametr winbind gid okre¶la zakres
	    identyfikatorów grup które s± alokowane przez demona
	    winbind. Zakres ten nie powinien zawieraæ istniej±cych
	    grup lokalnych lub nis, bo w przeciwnym wypadku mog±
	    wyst±piæ dziwne konflikty.</para>

	  <para>Domy¶lnie: <command>winbind gid = &lt;pusty ³añcuch znakowy&gt;
	      </command></para>
	  <para>Przyk³ad: <command>winbind gid = 10000-20000</command>
	    </para>
	</listitem>
      </varlistentry>
	
      <varlistentry>
	<term>winbind cache time</term>
	<listitem><para>Ten parametr okre¶la liczbê sekund przez które
	    demon <command>winbindd</command> bêdzie cache'owa³ dane
	    u¿ytkowników i grup przed ponownym pytaniem serwera Windows
	    NT. Gdy jaki¶ element w tym cache'u jest starszy ni¿ podany
	    tu czas, winbindd poprosi kontroler domeny o numer sekwencyjny
	    bazy danych kont na serwerze. Je¶li numer sekwencyjny nie
	    zmieni³ siê, wtedy cache'owany element jest oznaczany jako
	    wa¿ny (aktualny, przyp.t³um.) na nastêpne <parameter>winbind
	      cache time</parameter> sekund. W przeciwnym wypadku,
	    element jest pobrany z serwera. Oznacza to ¿e tak d³ugo,
	    jak baza danych kont nie jest zmieniana, winbindd bêdzie
	    musia³ wysy³aæ tylko jeden pakiet z pytaniem o numer
	    sekwencyjny co <parameter>winbind cache time</parameter>
	    sekund.</para>

	  <para>Domy¶lnie: <command>winbind cache time = 15</command>
	    </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>winbind enum users</term>
	<listitem><para>W wielkich instalacjach mo¿e byæ konieczne
	    powstrzymanie enumeracji u¿ytkowników poprzez grupê wywo³añ
	    systemowych <command>setpwent()</command>, <command>
	      getpwent()</command> i <command>endpwent()</command>.
	    Je¶li parametr <parameter>winbind enum users</parameter>
	    jest ustawiony na <constant>false</constant>, wywo³ania
	    systemowe <command>getpwent</command> nie zwróc± ¿adnych
	    danych.</para>

	  <para><emphasis>Ostrze¿enie:</emphasis> Wy³±czanie enumeracji
	    u¿ytkowników mo¿e spowodowaæ, ¿e niektóre programy bêd±
	    zachowywaæ siê dziwnie. Przyk³adowo, program finger jest
	    zale¿ny od posiadania dostêpu do pe³nej listy u¿ytkowników
	    podczas szukania pasuj±cych nazw u¿ytkowników.</para>

	  <para>Domy¶lnie: <command>winbind enum users = yes </command>
	    </para>
	</listitem>
      </varlistentry>

      <varlistentry>
	<term>winbind enum groups</term>
	<listitem><para>W wielkich instalacjach mo¿e byæ konieczne
	    powstrzymanie enumeracji grup poprzez grupê wywo³añ
	    systemowych <command>setgrent()</command>, <command>
	      getgrent()</command> i <command>endgrent()</command>.

	    Je¶li parametr <parameter>winbind enum groups</parameter>
	    jest ustawiony na <constant>false</constant>, wywo³ania
	    systemowe <command>getgrent</command> nie zwróc± ¿adnych
	    danych.</para>

	  <para><emphasis>Ostrze¿enie:</emphasis> Wy³±czanie enumeracji
	    grup mo¿e spowodowaæ, ¿e niektóre programy bêd±
	    zachowywaæ siê dziwnie.</para>

	  <para>Domy¶lnie: <command>winbind enum groups = no</command>
	    </para></listitem>
      </varlistentry>

      <varlistentry>
	<term>template homedir</term>
	<listitem><para>Przy wype³nianiu informacji o u¿ytkowniku
	    Windows NT, demon <command>winbindd</command> u¿ywa tego
	    parametru do wpisania katalogu domowego dla tego
	    u¿ytkownika. Je¶li obecny jest tu ³añcuch znakowy
	    <parameter>%D</parameter> jest on zastêpowany nazw± domeny
	    tego u¿ytkownika Windows NT. Je¶li obecny jest ³añcuch
	    <parameter>%U</parameter> jest on zastêpowany nazw±
	    u¿ytkownika Windows NT.</para>

	  <para>Domy¶lnie: <command>template homedir = /home/%D/%U
	    </command></para></listitem>
      </varlistentry>

      <varlistentry>
	<term>template shell</term>
	<listitem><para>Przy wype³nianiu informacji o u¿ytkowniku
	    Windows NT, demon <command>winbindd</command> u¿ywa tego
	    parametru do wpisania pow³oki dla tego u¿ytkownika.
	  </para>
	</listitem>
      </varlistentry>
    </variablelist>
</refsect1>

<refsect1>
    <title>PRZYK£ADOWE USTAWIENIE</title>

    <para>Aby ustawiæ winbindd na szukanie u¿ytkowników i grup
      plus autentykacjê z kontrolera domeny, u¿yj ustawieñ podobnych
      do poni¿szych. To by³o testowane na systemie RedHat 6.2 Linux.
    </para>

    <para>W <filename>/etc/nsswitch.conf</filename> wstaw to:</para>

    <para><programlisting>
passwd:     files winbind
group:      files winbind
    </programlisting></para>

    <para>W <filename>/etc/pam.d/*</filename> zast±p linie <parameter>
	auth</parameter> czym¶ podobnym:</para>

    <para><programlisting>
auth       required      /lib/security/pam_securetty.so
auth       required      /lib/security/pam_nologin.so
auth       sufficient    /lib/security/pam_winbind.so
auth       required      /lib/security/pam_pwdb.so use_first_pass shadow nullok
    </programlisting></para>

    <para>Zwróæ uwagê w szczególno¶ci na u¿ycie s³owa kluczowego <constant>
	sufficient</constant> i <constant>use_first_pass</constant>.</para>

    <para>Teraz zast±p linie konta (account) tym:</para>

    <para><command>account    required      /lib/security/pam_winbind.so
      </command></para>

    <para>Nastêpnym krokiem bêdzie przy³±czenie siê do domeny. Aby to zrobiæ
      u¿yj programu <command>smbpasswd</command> w ten sposób:</para>

    <para><command>smbpasswd -j DOMENA -r PDC -U Administrator</command></para>

    <para>Nazwa u¿ytkownika po <parameter>-U</parameter> mo¿e byæ nazw±
      ka¿dego u¿ytkownika Domeny który ma przywileje administracyjne.
      Zast±p nazwê "DOMENA" swoj± nazw± domeny, a nazwê "PDC" nazw± swojego
      PDC.</para>

    <para>Nastêpnie skopiuj <filename>libnss_winbind.so</filename>
      do <filename>/lib</filename>, a <filename>pam_winbind.so</filename>
      do <filename>/lib/security/</filename>. Potrzebne jest dowi±zanie
      symboliczne z <filename>/lib/libnss_winbind.so</filename> do
      <filename>/lib/libnss_winbind.so.2</filename>. Je¶li u¿ywasz
      starszej wersji glibc, wtedy celem dowi±zania powinien byæ
      <filename>/lib/libnss_winbind.so.1</filename>.</para>

    <para>Na koniec, utwórz <filename>smb.conf</filename> zawieraj±cy
      dyrektywy jak poni¿ej:</para>

    <para><programlisting>
[global]
        winbind separator = +
        winbind cache time = 10
        template shell = /bin/bash
        template homedir = /home/%D/%U
        winbind uid = 10000-20000
        winbind gid = 10000-20000
        workgroup = DOMENA
        security = domain
        password server = *
    </programlisting></para>

    <para>Teraz uruchom <command>winbindd</command> i powiniene¶
      zauwa¼yæ, ¿e twoja baza danych u¿ytkowników i grup jest
      powiêkszona o twoich u¿ytkowników i grupy NT, oraz ¿e mo¿esz
      zalogowaæ siê do twojego systemu unix jako u¿ytkownik z
      domeny, przy u¿yciu sk³adni DOMENA+u¿ytkownik jako nazwa
      u¿ytkownika. Mo¿esz chcieæ skorzystaæ z poleceñ <command>
	getent passwd</command> i <command>getent group</command>
      ¿eby potwierdziæ poprawne funkcjonowanie <command>winbindd
      </command>.</para>
</refsect1>

<refsect1>
    <title>NOTATKI</title>

    <para>Poni¿sze notatki s± przydatne podczas konfigurowania i
      uruchamiania <command>winbindd</command>: </para>

    <para><command>nmbd</command> musi dzia³aæ na lokalnej maszynie
      ¿eby <command>winbindd</command> dzia³a³. <command>winbindd
      </command> sprawdza listê zaufanych domen (trusted domains)
      dla serwera Windows NT przy starcie i gdy odbierze sygna³
      SIGHUP. W ten sposób, aby dzia³aj±cy <command>winbindd</command>
      dowiedzia³ siê o nowych relacjach zaufania miêdzy serwerami,
      musi otrzymaæ sygna³ SIGHUP.</para>

    <para>Procesy klienckie odwzorowuj±ce nazwy poprzez modu³ nsswitch
      <command>winbindd</command> czytaj± zmienn± ¶rodowiskow± o nazwie
      <envar>$WINBINDD_DOMAIN</envar>. Je¶li ta zmienna zawiera listê
      nazw domen Windows NT odddzielonych przecinkami, to winbindd odwzoruje
      tylko u¿ytkowników i grupy w tych domenach Windows NT.</para>

    <para>Naprawdê ³atwo jest zdekonfigurowaæ PAM. Upewnij siê ¿e wiesz
      co robisz, modyfikuj±c jego pliki konfiguracyjne. Mo¿na ustawiæ
      PAM w taki sposób, ¿e nie bêdziesz siê ju¿ móg³ zalogowaæ
      do systemu.</para>

    <para>Je¶li na wiêcej ni¿ jednej maszynie UNIX dzia³a <command>
	winbindd</command> wówczas - generalnie - identyfikatory
      u¿ytkowników i grup alokowane przez winbindd nie bêd± takie
      same. Bêd± one poprawne tylko dla lokalnej maszyny.</para>

    <para>Je¶li plik mapuj±cy Windows NT RID na id u¿ytkownika i
      grupy UNIX zostanie uszkodzony lub zniszczony, wtedy mapowania
      bêd± stracone.</para>
</refsect1>

<refsect1>
    <title>SYGNA£Y</title>

    <para>Poni¿sze sygna³y mog± byæ wykorzystane do
      manipulowania demonem <command>winbindd</command>.</para>

    <variablelist>
      <varlistentry>
	<term>SIGHUP</term>
	<listitem><para>Prze³aduj plik <filename>smb.conf(5)
	    </filename> i wprowad¼ wszystkie zmiany parametrów
	    do dzia³aj±cej wersji winbindd. Ten sygna³ równie¿
	    oczyszcza cache'owane dane u¿ytkowników i grup.
	    Lista innych domen zaufanych przez winbindd jest
	    równie¿ prze³adowana.</para></listitem>
      </varlistentry>

      <varlistentry>
	<term>SIGUSR1</term>
	<listitem><para>Sygna³ SIGUSR1 spowoduje, ¿e <command>
	      winbindd</command> zapisze informacje o statusie
	    do pliku logu winbind, w³±cznie z informacjami o liczbie
	    u¿ytkowników i grup alokowanych przez <command>
	      winbindd</command>.</para>

	  <para>Pliki logu s± przechowywane pliku okre¶lonym
	    parametrem <parameter>log file</parameter>.</para>
	</listitem>
      </varlistentry>
    </variablelist>
</refsect1>

<refsect1>
    <title>PLIKI</title>

    <variablelist>
      <varlistentry>
	<term><filename>/etc/nsswitch.conf(5)</filename></term>
	<listitem><para>Plik konfiguracyjny prze³±cznika us³ug
	    nazewniczych (name service switch, dalej u¿ywana
	    jest nazwa oryginalna)</para>
	  </listitem>
      </varlistentry>

      <varlistentry>
	<term>/tmp/.winbindd/pipe</term>
	<listitem><para>£±cze UNIX przez które klienci komunikuj±
	    siê z programem <command>winbindd</command>. Z powodu
	    bezpieczeñstwa klient winbind bêdzie próbowa³ po³±czyæ
	    siê z demonem winbindd tylko, je¶li zarówno katalog
	    <filename>/tmp/.winbindd</filename> jak i plik <filename>
	      /tmp/.winbindd/pipe</filename> bêd± w³asno¶ci± root'a.
	    </para></listitem>
      </varlistentry>

      <varlistentry>
	<term>/lib/libnss_winbind.so.X</term>
	<listitem><para>Implementacja biblioteki name service switch.
	  </para></listitem>
      </varlistentry>

      <varlistentry>
	<term>$LOCKDIR/winbindd_idmap.tdb</term>
	<listitem><para>"Magazyn" mapowania Windows NT rid na id
	    u¿ytkownika/grupy UNIX. Katalog blokad jest okre¶lony
	    przy u¿yciu opcji <parameter>--with-lockdir</parameter>
	    gdy Samba jest na pocz±tku kompilowana. Domy¶lnie jest
	    to katalog <filename>/usr/local/samba/var/lock</filename>.
	    </para></listitem>
      </varlistentry>

      <varlistentry>
	<term>$LOCKDIR/winbindd_cache.tdb</term>
	<listitem><para>"Magazyn" dla cache'owanych danych u¿ytkowników
	    i grup.</para></listitem>
      </varlistentry>
    </variablelist>
</refsect1>

<refsect1>
    <title>WERSJA</title>

    <para>Ta strona podrêcznika jest poprawna dla wersji 2.2 pakietu
      Samba.</para>
</refsect1>

<refsect1>
    <title>ZOBACZ TE¯</title>

    <para><filename>nsswitch.conf(5)</filename>,
      <ulink url="samba.7.html">samba(7)</ulink>,
      <ulink url="wbinfo.1.html">wbinfo(1)</ulink>,
      <ulink url="smb.conf.5.html">smb.conf(5)</ulink></para>
</refsect1>

<refsect1>
    <title>AUTOR</title>

    <para>Pierwotnie, Samba i zwi±zane z ni± oprogramowanie by³y
      stworzone przez Andrew Tridgella . Samba jest teraz
      rozwijana przez Zespó³ Samba jako projekt Open Source
      podobnie jak j±dro Linux.</para>

    <para><command>wbinfo</command> i <command>winbindd</command>
      zosta³y napisane przez Tima Pottera.</para>

    <para>Konwersja do DocBook dla Samba 2.2 zosta³a wykonana przez
      Geralda Cartera. T³umaczenie na jêzyk polski wykona³ Rafa³
      Szcze¶niak.</para>
</refsect1>

</refentry>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:t
sgml-shorttag:t
sgml-namecase-general:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:2
sgml-indent-data:t
sgml-parent-document:nil
sgml-exposed-tags:nil
sgml-local-catalogs:("/usr/lib/sgml/catalog")
sgml-local-ecat-files:nil
End:
-->
