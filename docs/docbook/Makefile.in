#################################################################
# Makefile.in for Samba Documentation
# Authors:	James Moore <jmoore@php.net>
#               Gerald Carter <jerry@samba.org>
#
# Please see http://www.samba.org/samba/cvs.html
# for information on getting the latest  
# source and doucmentation source files.  
#

# Autoconf Variables
SRCDIR = @srcdir@
JADE = @JADE@
NSGMLS = @NSGMLS@
ONSGMLS=@ONSGMLS@
SGMLSPL=@SGMLSPL@
#CATALOG = @CATALOG@

#Stylesheets and Dependicies
SGML_SHARE=/usr/local/share/sgml
HTML_STYLESHEET = $(srcdir)/stylesheets/html.dsl
HTML_DEPS = $(srcdir)/stylesheets/html-common.dsl $(srcdir)/stylesheets/common.dsl
SGML_SHARE=/usr/local/share/sgml

MANPAGES=findsmb.1 smbclient.1 \
	smbspool.8 lmhosts.5 \
	smbcontrol.1  smbstatus.1 \
	make_smbcodepage.1  smbd.8 \
	smbtar.1 nmbd.8 smbmnt.8 \
	smbumount.8 nmblookup.1 \
	smbmount.8 swat.8 rpcclient.1	 \
	smbpasswd.5 testparm.1 samba.7 \
	smbpasswd.8 testprns.1 \
	smb.conf.5 smbrun.1 wbinfo.1 \
	smbcacls.1 smbsh.1 winbindd.8 

######################################################################
# Make instructions
######################################################################
all: man html

man: 
	@echo Building man pages...
	@for file in `/bin/ls manpages/*sgml`; do \
	   manfile=`basename $$file | sed "s/\.sgml//g"`; \
	   echo "Making $$manfile"; \
	   $(ONSGMLS) -f /tmp/docbook2x.log $$file | $(SGMLSPL) \
	      $(SGML_SHARE)/docbook2X/docbook2man-spec.pl; \
	   cat /tmp/docbook2x.log | grep -v DTDDECL; \
	   /bin/rm -f /tmp/docbook2x.log; \
	   /bin/mv -f $$manfile ../manpages/$$manfile; \
	done
	
html:
	@echo Building HTML formatted man pages...
		@for file in `/bin/ls manpages/*sgml`; do \
	   htmlfile=`basename $$file | sed "s/\.sgml/\.html/g"`; \
	   echo "Making $$htmlfile"; \
	   $(JADE) -t sgml -V nochunks -d  $(SGML_SHARE)/dsssl/docbook/html/docbook.dsl \
	      -f /tmp/jade.log $$file > ../htmldocs/$$htmlfile; \
	   cat /tmp/jade.log | grep -v DTDDECL; \
	   /bin/rm -f /tmp/jade.log; \
	done


##
## these rules are for building individual files
##
findsmb.1:  manpages/findsmb.1.sgml
	@echo "Making $@"
	@$(ONSGMLS) -f /tmp/docbook2x.log $< | $(SGMLSPL) \
	   $(SGML_SHARE)/docbook2X/docbook2man-spec.pl
	@cat /tmp/docbook2x.log | grep -v DTDDECL
	@/bin/rm -f /tmp/docbook2x.log
	
smbclient.1: manpages/smbclient.1.sgml
	@echo "Making $@"
	@$(ONSGMLS) -f /tmp/docbook2x.log $< | $(SGMLSPL) \
	   $(SGML_SHARE)/docbook2X/docbook2man-spec.pl
	@cat /tmp/docbook2x.log | grep -v DTDDECL
	@/bin/rm -f /tmp/docbook2x.log

smbspool.8: manpages/smbspool.8.sgml
	@echo "Making $@"
	@$(ONSGMLS) -f /tmp/docbook2x.log $< | $(SGMLSPL) \
	   $(SGML_SHARE)/docbook2X/docbook2man-spec.pl
	@cat /tmp/docbook2x.log | grep -v DTDDECL
	@/bin/rm -f /tmp/docbook2x.log

lmhosts.5: manpages/lmhosts.5.sgml
	@echo "Making $@"
	@$(ONSGMLS) -f /tmp/docbook2x.log $< | $(SGMLSPL) \
	   $(SGML_SHARE)/docbook2X/docbook2man-spec.pl
	@cat /tmp/docbook2x.log | grep -v DTDDECL
	@/bin/rm -f /tmp/docbook2x.log

smbcontrol.1: manpages/smbcontrol.1.sgml
	@echo "Making $@"
	@$(ONSGMLS) -f /tmp/docbook2x.log $< | $(SGMLSPL) \
	   $(SGML_SHARE)/docbook2X/docbook2man-spec.pl
	@cat /tmp/docbook2x.log | grep -v DTDDECL
	@/bin/rm -f /tmp/docbook2x.log

smbstatus.1: manpages/smbstatus.1.sgml
	@echo "Making $@"
	@$(ONSGMLS) -f /tmp/docbook2x.log $< | $(SGMLSPL) \
	   $(SGML_SHARE)/docbook2X/docbook2man-spec.pl
	@cat /tmp/docbook2x.log | grep -v DTDDECL
	@/bin/rm -f /tmp/docbook2x.log

make_smbcodepage.1: manpages/make_smbcodepage.1.sgml
	@echo "Making $@"
	@$(ONSGMLS) -f /tmp/docbook2x.log $< | $(SGMLSPL) \
	   $(SGML_SHARE)/docbook2X/docbook2man-spec.pl
	@cat /tmp/docbook2x.log | grep -v DTDDECL
	@/bin/rm -f /tmp/docbook2x.log

smbd.8: manpages/smbd.8.sgml
	@echo "Making $@"
	@$(ONSGMLS) -f /tmp/docbook2x.log $< | $(SGMLSPL) \
	   $(SGML_SHARE)/docbook2X/docbook2man-spec.pl
	@cat /tmp/docbook2x.log | grep -v DTDDECL
	@/bin/rm -f /tmp/docbook2x.log

smbtar.1: manpages/smbtar.1.sgml
	@echo "Making $@"
	@$(ONSGMLS) -f /tmp/docbook2x.log $< | $(SGMLSPL) \
	   $(SGML_SHARE)/docbook2X/docbook2man-spec.pl
	@cat /tmp/docbook2x.log | grep -v DTDDECL
	@/bin/rm -f /tmp/docbook2x.log

nmbd.8: manpages/nmbd.8.sgml
	@echo "Making $@"
	@$(ONSGMLS) -f /tmp/docbook2x.log $< | $(SGMLSPL) \
	   $(SGML_SHARE)/docbook2X/docbook2man-spec.pl
	@cat /tmp/docbook2x.log | grep -v DTDDECL
	@/bin/rm -f /tmp/docbook2x.log

smbmnt.8: manpages/smbmnt.8.sgml
	@echo "Making $@"
	@$(ONSGMLS) -f /tmp/docbook2x.log $< | $(SGMLSPL) \
	   $(SGML_SHARE)/docbook2X/docbook2man-spec.pl
	@cat /tmp/docbook2x.log | grep -v DTDDECL
	@/bin/rm -f /tmp/docbook2x.log

smbumount.8: manpages/smbumount.8.sgml
	@echo "Making $@"
	@$(ONSGMLS) -f /tmp/docbook2x.log $< | $(SGMLSPL) \
	   $(SGML_SHARE)/docbook2X/docbook2man-spec.pl
	@cat /tmp/docbook2x.log | grep -v DTDDECL
	@/bin/rm -f /tmp/docbook2x.log

nmblookup.1: manpages/nmblookup.1.sgml
	@echo "Making $@"
	@$(ONSGMLS) -f /tmp/docbook2x.log $< | $(SGMLSPL) \
	   $(SGML_SHARE)/docbook2X/docbook2man-spec.pl
	@cat /tmp/docbook2x.log | grep -v DTDDECL
	@/bin/rm -f /tmp/docbook2x.log

smbmount.8: manpages/smbmount.8.sgml
	@echo "Making $@"
	@$(ONSGMLS) -f /tmp/docbook2x.log $< | $(SGMLSPL) \
	   $(SGML_SHARE)/docbook2X/docbook2man-spec.pl
	@cat /tmp/docbook2x.log | grep -v DTDDECL
	@/bin/rm -f /tmp/docbook2x.log

swat.8: manpages/swat.8.sgml
	@echo "Making $@"
	@$(ONSGMLS) -f /tmp/docbook2x.log $< | $(SGMLSPL) \
	   $(SGML_SHARE)/docbook2X/docbook2man-spec.pl
	@cat /tmp/docbook2x.log | grep -v DTDDECL
	@/bin/rm -f /tmp/docbook2x.log

rpcclient.1: manpages/rpcclient.1.sgml
	@echo "Making $@"
	@$(ONSGMLS) -f /tmp/docbook2x.log $< | $(SGMLSPL) \
	   $(SGML_SHARE)/docbook2X/docbook2man-spec.pl
	@cat /tmp/docbook2x.log | grep -v DTDDECL
	@/bin/rm -f /tmp/docbook2x.log

smbpasswd.5: manpages/smbpasswd.5.sgml
	@echo "Making $@"
	@$(ONSGMLS) -f /tmp/docbook2x.log $< | $(SGMLSPL) \
	   $(SGML_SHARE)/docbook2X/docbook2man-spec.pl
	@cat /tmp/docbook2x.log | grep -v DTDDECL
	@/bin/rm -f /tmp/docbook2x.log

testparm.1: manpages/testparm.1.sgml
	@echo "Making $@"
	@$(ONSGMLS) -f /tmp/docbook2x.log $< | $(SGMLSPL) \
	   $(SGML_SHARE)/docbook2X/docbook2man-spec.pl
	@cat /tmp/docbook2x.log | grep -v DTDDECL
	@/bin/rm -f /tmp/docbook2x.log

samba.7: manpages/samba.7.sgml
	@echo "Making $@"
	@$(ONSGMLS) -f /tmp/docbook2x.log $< | $(SGMLSPL) \
	   $(SGML_SHARE)/docbook2X/docbook2man-spec.pl
	@cat /tmp/docbook2x.log | grep -v DTDDECL
	@/bin/rm -f /tmp/docbook2x.log

smbpasswd.8: manpages/smbpasswd.8.sgml
	@echo "Making $@"
	@$(ONSGMLS) -f /tmp/docbook2x.log $< | $(SGMLSPL) \
	   $(SGML_SHARE)/docbook2X/docbook2man-spec.pl
	@cat /tmp/docbook2x.log | grep -v DTDDECL
	@/bin/rm -f /tmp/docbook2x.log

testprns.1: manpages/testprns.1.sgml
	@echo "Making $@"
	@$(ONSGMLS) -f /tmp/docbook2x.log $< | $(SGMLSPL) \
	   $(SGML_SHARE)/docbook2X/docbook2man-spec.pl
	@cat /tmp/docbook2x.log | grep -v DTDDECL
	@/bin/rm -f /tmp/docbook2x.log

smb.conf.5: manpages/smb.conf.5.sgml
	@echo "Making $@"
	@$(ONSGMLS) -f /tmp/docbook2x.log $< | $(SGMLSPL) \
	   $(SGML_SHARE)/docbook2X/docbook2man-spec.pl
	@cat /tmp/docbook2x.log | grep -v DTDDECL
	@/bin/rm -f /tmp/docbook2x.log

smbrun.1: manpages/smbrun.1.sgml
	@echo "Making $@"
	@$(ONSGMLS) -f /tmp/docbook2x.log $< | $(SGMLSPL) \
	   $(SGML_SHARE)/docbook2X/docbook2man-spec.pl
	@cat /tmp/docbook2x.log | grep -v DTDDECL
	@/bin/rm -f /tmp/docbook2x.log

wbinfo.1: manpages/wbinfo.1.sgml
	@echo "Making $@"
	@$(ONSGMLS) -f /tmp/docbook2x.log $< | $(SGMLSPL) \
	   $(SGML_SHARE)/docbook2X/docbook2man-spec.pl
	@cat /tmp/docbook2x.log | grep -v DTDDECL
	@/bin/rm -f /tmp/docbook2x.log

smbcacls.1: manpages/smbcacls.1.sgml
	@echo "Making $@"
	@$(ONSGMLS) -f /tmp/docbook2x.log $< | $(SGMLSPL) \
	   $(SGML_SHARE)/docbook2X/docbook2man-spec.pl
	@cat /tmp/docbook2x.log | grep -v DTDDECL
	@/bin/rm -f /tmp/docbook2x.log

smbsh.1 : manpages/smbsh.1.sgml
	@echo "Making $@"
	@$(ONSGMLS) -f /tmp/docbook2x.log $< | $(SGMLSPL) \
	   $(SGML_SHARE)/docbook2X/docbook2man-spec.pl
	@cat /tmp/docbook2x.log | grep -v DTDDECL
	@/bin/rm -f /tmp/docbook2x.log

winbindd.8: manpages/winbindd.8.sgml
	@echo "Making $@"
	@$(ONSGMLS) -f /tmp/docbook2x.log $< | $(SGMLSPL) \
	   $(SGML_SHARE)/docbook2X/docbook2man-spec.pl
	@cat /tmp/docbook2x.log | grep -v DTDDECL
	@/bin/rm -f /tmp/docbook2x.log




## Clean Rule
clean: 
	/bin/rm -f manpage.*
