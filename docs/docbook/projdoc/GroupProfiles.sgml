<chapter id="GroupProfiles">
<chapterinfo>
	<author>
		<firstname>John</firstname><surname>Terpstra</surname>
	</author>
	<author>
		<firstname>Jelmer</firstname><surname>Vernooij</surname>
	</author>
	<author>
		<firstname>John</firstname><surname>Russell</surname>
		<affiliation>
			<address><email>apca72@dsl.pipex.com</email></address>
		</affiliation>
	</author>
</chapterinfo>

<title>Creating Group Prolicy Files</title>

<sect1>
<title>Windows '9x</title>
<para>
You need the Win98 Group Policy Editor to
set Group Profiles up under Windows '9x. It can be found on the Original
full product Win98 installation CD under 
<filename>tools/reskit/netadmin/poledit</filename>.  You install this
using the Add/Remove Programs facility and then click on the 'Have Disk'
tab.
</para>

<para>
Use the Group Policy Editor to create a policy file that specifies the
location of user profiles and/or the <filename>My Documents</filename> etc.
stuff. You then save these settings in a file called
<filename>Config.POL</filename> that needs to be placed in
the root of the [NETLOGON] share. If your Win98 is configured to log onto
the Samba Domain, it will automatically read this file and update the
Win9x/Me registry of the machine that is logging on.
</para>

<para>
All of this is covered in the Win98 Resource Kit documentation.
</para>

<para>
If you do not do it this way, then every so often Win9x/Me will check the
integrity of the registry and will restore it's settings from the back-up
copy of the registry it stores on each Win9x/Me machine. Hence, you will
occasionally notice things changing back to the original settings.
</para>

<para>
The following all refers to Windows NT/200x profile migration - not to policies.
We need a separate section on policies (NTConfig.Pol) for NT4/200x.
</para>
</sect1>

<sect1>
<title>Windows NT 4</title>

<para>
Unfortunately, the Resource Kit info is Win NT4 or 200x specific.
</para>

<para>
Here is a quick guide:
</para>

<itemizedlist>

<listitem><para>
On your NT4 Domain Controller, right click on 'My Computer', then
select the tab labelled 'User Profiles'.
</para></listitem>

<listitem><para>
Select a user profile you want to migrate and click on it.
</para>

<note><para>I am using the term &quot;migrate&quot; lossely. You can copy a profile to
create a group profile. You can give the user 'Everyone' rights to the
profile you copy this to. That is what you need to do, since your samba
domain is not a member of a trust relationship with your NT4 PDC.</para></note>
</listitem>

<listitem><para>Click the 'Copy To' button.</para></listitem>

<listitem><para>In the box labelled 'Copy Profile to' add your new path, eg:
<filename>c:\temp\foobar</filename></para></listitem>

<listitem><para>Click on the button labelled 'Change' in the "Permitted to use" box.</para></listitem>

<listitem><para>Click on the group 'Everyone' and then click OK. This closes the
'chose user' box.</para></listitem>

<listitem><para>Now click OK.</para></listitem>
</itemizedlist>

<para>
Follow the above for every profile you need to migrate.
</para>

<sect2>
<title>Side bar Notes</title>

<para>
You should obtain the SID of your NT4 domain. You can use smbpasswd to do
this. Read the man page.</para>

<para>
With Samba-3.0.0 alpha code you can import all you NT4 domain accounts
using the net samsync method. This way you can retain your profile
settings as well as all your users.
</para>

</sect2>

<sect2>
<title>Mandatory profiles</title>

<para>
The above method can be used to create mandatory profiles also. To convert
a group profile into a mandatory profile simply locate the NTUser.DAT file
in the copied profile and rename it to NTUser.MAN.
</para>

</sect2>

<sect2>
<title>moveuser.exe</title>

<para>
The W2K professional resource kit has moveuser.exe. moveuser.exe changes
the security of a profile from one user to another.  This allows the account 
domain to change, and/or the user name to change.
</para>

</sect2>

<sect2>
<title>Get SID</title>

<para>
You can identify the SID by using GetSID.exe from the Windows NT Server 4.0
Resource Kit.
</para>

<para>
Windows NT 4.0 stores the local profile information in the registry under
the following key:
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList
</para>

<para>
Under the ProfileList key, there will be subkeys named with the SIDs of the
users who have logged on to this computer. (To find the profile information
for the user whose locally cached profile you want to move, find the SID for
the user with the GetSID.exe utility.) Inside of the appropriate user's
subkey, you will see a string value named ProfileImagePath.
</para>

</sect2>

</sect1>

<sect1>
<title>Windows 2000/XP</title>

<para>
You must first convert the profile from a local profile to a domain
profile on the MS Windows workstation as follows:
</para>

<itemizedlist>
<listitem><para>
Log on as the LOCAL workstation administrator.
</para></listitem>

<listitem><para>
Right click on the 'My Computer' Icon, select 'Properties'
</para></listitem>

<listitem><para>
Click on the 'User Profiles' tab
</para></listitem>

<listitem><para>
Select the profile you wish to convert (click on it once)
</para></listitem>

<listitem><para>
Click on the button 'Copy To'
</para></listitem>

<listitem><para>
In the "Permitted to use" box, click on the 'Change' button.
</para></listitem>

<listitem><para>
Click on the 'Look in" area that lists the machine name, when you click
here it will open up a selection box. Click on the domain to which the
profile must be accessible.
</para>

<note><para>You will need to log on if a logon box opens up. Eg: In the connect
as: MIDEARTH\root, password: mypassword.</para></note>
</listitem>

<listitem><para>
To make the profile capable of being used by anyone select 'Everyone'
</para></listitem>

<listitem><para>
Click OK. The Selection box will close.
</para></listitem>

<listitem><para>
Now click on the 'Ok' button to create the profile in the path you
nominated.
</para></listitem>
</itemizedlist>

<para>
Done. You now have a profile that can be editted using the samba-3.0.0
profiles tool.
</para>

<note>
<para>
Under NT/2K the use of mandotory profiles forces the use of MS Exchange
storage of mail data. That keeps desktop profiles usable.
</para>
</note>

<note>
<itemizedlist>
<listitem><para>
This is a security check new to Windows XP (or maybe only
Windows XP service pack 1).  It can be disabled via a group policy in
Active Directory.  The policy is:</para>

<para>"Computer Configuration\Administrative Templates\System\User
Profiles\Do not check for user ownership of Roaming Profile Folders"</para>

<para>...and it should be set to "Enabled".
Does the new version of samba have an Active Directory analogue?  If so,
then you may be able to set the policy through this.
</para>

<para>
If you cannot set group policies in samba, then you may be able to set
the policy locally on each machine.  If you want to try this, then do
the following (N.B. I don't know for sure that this will work in the
same way as a domain group policy):
</para>

</listitem>

<listitem><para>
On the XP workstation log in with an Administrator account.
</para></listitem>

<listitem><para>Click: "Start", "Run"</para></listitem>
<listitem><para>Type: "mmc"</para></listitem>
<listitem><para>Click: "OK"</para></listitem>

<listitem><para>A Microsoft Management Console should appear.</para></listitem>
<listitem><para>Click: File, "Add/Remove Snap-in...", "Add"</para></listitem>
<listitem><para>Double-Click: "Group Policy"</para></listitem>
<listitem><para>Click: "Finish", "Close"</para></listitem>
<listitem><para>Click: "OK"</para></listitem>

<listitem><para>In the "Console Root" window:</para></listitem>
<listitem><para>Expand: "Local Computer Policy", "Computer Configuration",</para></listitem>
<listitem><para>"Administrative Templates", "System", "User Profiles"</para></listitem>
<listitem><para>Double-Click: "Do not check for user ownership of Roaming Profile</para></listitem>
<listitem><para>Folders"</para></listitem>
<listitem><para>Select: "Enabled"</para></listitem>
<listitem><para>Click: OK"</para></listitem>

<listitem><para>Close the whole console.  You do not need to save the settings (this
refers to the console settings rather than the policies you have
changed).</para></listitem>

<listitem><para>Reboot</para></listitem>
</itemizedlist>
</note>

</sect1>
</chapter>
