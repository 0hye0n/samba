<chapter id="install">
<chapterinfo>
	&author.tridge;
	&author.jelmer;
	&author.jht;
	<author><firstname>Karl</firstname><surname>Auer</surname></author>
	<!-- Isn't some of this written by others as well? -->

</chapterinfo>

<title>How to Install and Test SAMBA</title>

<sect1>
	<title>Obtaining and installing samba</title>

	<para>
	Binary packages of samba are included in almost any Linux or
	Unix distribution. There are also some packages available at 
	<ulink url="http://samba.org/">the samba homepage</ulink>.
	</para>

	<para>If you need to compile samba from source, check the 
	<link linkend="compiling">appropriate appendix chapter</link>.</para>

	<para>If you have already installed samba, or if your operating system
	was pre-installed with samba, then you may not need to bother with this
	chapter. On the other hand, you may want to read this chapter anyhow
	for information about updating samba.</para>

</sect1>

<sect1>
	<title>Configuring samba (smb.conf)</title>

	<para>
	Samba's configuration is stored in the &smb.conf; file, 
	that usually resides in <filename>/etc/samba/smb.conf</filename> 
	or <filename>/usr/local/samba/lib/smb.conf</filename>. You can either 
	edit this file yourself or do it using one of the many graphical 
	tools that are available, such as the web-based interface swat, that 
	is included with samba.
	</para>
	
<sect2>
	<title>Example Configuration</title>
	
	<para>
	There are sample configuration files in the examples subdirectory in the
	distribution. I suggest you read them carefully so you can see how the options
	go together in practice. See the man page for all the options.
	</para>

	<para>
	The simplest useful configuration file would be something like this:
	</para>

	<para>
	<programlisting>
	[global]
		workgroup = MYGROUP

	[homes]
		guest ok = no
		read only = no
	</programlisting>
	</para>
	
	<para>
	This will allow connections by anyone with an account on the server, using either
	their login name or "<parameter>homes</parameter>" as the service name.
	(Note that the workgroup that Samba must also be set.)
	</para>
	
	<para>
	Make sure you put the <filename>smb.conf</filename> file in the same place 
	you specified in the <filename>Makefile</filename> (the default is to 
	look for it in <filename>/usr/local/samba/lib/</filename>).
	</para>

	<para>
	For more information about security settings for the 
	<parameter>[homes]</parameter> share please refer to the chapter 
	<link linkend="securing-samba">Securing Samba</link>.
	</para>

<sect3>
	<title>Test your config file with <command>testparm</command></title>

	<para>
	It's important that you test the validity of your <filename>smb.conf</filename>
	file using the &testparm; program. If testparm runs OK
	then it will list the loaded services. If not it will give an error message.
	</para>

	<para>
	Make sure it runs OK and that the services look reasonable before proceeding.
	</para>

	<para>
	Always run testparm again when you change &smb.conf;!
	</para>

</sect3>
</sect2>

<sect2>
	<title>SWAT</title>

	<para>
	SWAT is a web-based interface that helps you configure samba. 
	SWAT might not be available in the samba package on your platform, 
	but in a separate package. Please read the swat manpage 
	on compiling, installing and configuring swat from source.
	</para>

	<para>
	To launch SWAT just run your favorite web browser and 
	point it at <ulink url="http://localhost:901/">http://localhost:901/</ulink>. Replace
	<replaceable>localhost</replaceable>
	with the name of the computer you are running samba on if you 
	are running samba on a different computer than your browser.
	</para>

	<para>
	Note that you can attach to SWAT from any IP connected 
	machine but connecting from a remote machine leaves your 
	connection open to password sniffing as passwords will be sent 
	in the clear over the wire. 
	</para>
</sect2>
</sect1>

<sect1>
	<title>Try listing the shares available on your 
	server</title>

	<para><prompt>$ </prompt><userinput>smbclient -L 
	<replaceable>yourhostname</replaceable></userinput></para>

	<para>You should get back a list of shares available on 
	your server. If you don't then something is incorrectly setup. 
	Note that this method can also be used to see what shares 
	are available on other LanManager clients (such as WfWg).</para>

	<para>If you choose user level security then you may find 
	that Samba requests a password before it will list the shares. 
	See the <command>smbclient</command> man page for details. (you 
	can force it to list the shares without a password by
	adding the option -U% to the command line. This will not work 
	with non-Samba servers)</para>
</sect1>

<sect1>
	<title>Try connecting with the unix client</title>
	
	<para><prompt>$ </prompt><userinput>smbclient <replaceable>
	//yourhostname/aservice</replaceable></userinput></para>
	
	<para>Typically the <replaceable>yourhostname</replaceable> 
	would be the name of the host where you installed &smbd;. 
	The <replaceable>aservice</replaceable> is 
	any service you have defined in the &smb.conf;
	file. Try your user name if you just have a <parameter>[homes]</parameter>
	section
	in &smb.conf;.</para>

	<para>For example if your unix host is <replaceable>bambi</replaceable>
	and your login name is <replaceable>fred</replaceable> you would type:</para>

	<para><prompt>$ </prompt><userinput>smbclient //<replaceable>bambi</replaceable>/<replaceable>fred</replaceable>
	</userinput></para>
</sect1>

<sect1>
	<title>Try connecting from a DOS, WfWg, Win9x, WinNT, 
	Win2k, OS/2, etc... client</title>
	
	<para>Try mounting disks. eg:</para>

	<para><prompt>C:\WINDOWS\> </prompt><userinput>net use d: \\servername\service
	</userinput></para>

	<para>Try printing. eg:</para>

	<para><prompt>C:\WINDOWS\> </prompt><userinput>net use lpt1:
	\\servername\spoolservice</userinput></para>

	<para><prompt>C:\WINDOWS\> </prompt><userinput>print filename
	</userinput></para>
</sect1>

<sect1>
	<title>What If Things Don't Work?</title>
	
	<para>Then you might read the file chapter 
	<link linkend="diagnosis">Diagnosis</link> and the 
	FAQ. If you are still stuck then try to follow 
	the <link linkend="problems">Analysing and Solving Problems chapter</link>
	Samba has been successfully installed at thousands of sites worldwide,
	so maybe someone else has hit your problem and has overcome it. </para>

</sect1>

<sect1>
<title>Common Errors</title>

<para>
The following questions and issues get raised on the samba mailing list over and over again.
</para>

<sect2>
<title>Why are so many smbd processes eating memory?</title>

<para>
<quote>
Site that is running Samba on an AIX box. They are sharing out about 2 terabytes using samba.
Samba was installed using smitty and the binaries. We seem to be experiencing a memory problem
with this box.  When I do a <command>svmon -Pu</command> the monitoring program shows that &smbd; has several
processes of smbd running:
</quote>
</para>

<para>
	<quote>
Is samba suppose to start this many different smbd processes?  Or does it run as one smbd process?  Also
is it normal for it to be taking up this much memory?
</quote>
</para>

<para>
<screen>
Inuse * 4096 = amount of memory being used by this process

     Pid Command        Inuse      Pin     Pgsp  Virtual   64-bit    Mthrd
   20950 smbd           33098     1906      181     5017        N        N
   22262 smbd            9104     1906      5410
   21060 smbd            9048     1906      181     5479        N        N
   25972 smbd            8678     1906      181     5109        N        N
   24524 smbd            8674     1906      181     5105        N        N
   19262 smbd            8582     1906      181     5013        N        N
   20722 smbd            8572     1906      181     5003        N        N
   21454 smbd            8572     1906      181     5003        N        N
   28946 smbd            8567     1906      181     4996        N        N
   24076 smbd            8566     1906      181     4996        N        N
   20138 smbd            8566     1906      181     4996        N        N
   17608 smbd            8565     1906      181     4996        N        N
   21820 smbd            8565     1906      181     4996        N        N
   26940 smbd            8565     1906      181     4996        N        N
   19884 smbd            8565     1906      181     4996        N        N
    9912 smbd            8565     1906      181     4996        N        N
   25800 smbd            8564     1906      181     4995        N        N
   20452 smbd            8564     1906      181     4995        N        N
   18592 smbd            8562     1906      181     4993        N        N
   28216 smbd            8521     1906      181     4954        N        N
   19110 smbd            8404     1906      181     4862        N        N

   Total memory used:  841,592,832 bytes
</screen>
</para>


<para>
Samba consists on three core programs:
&nmbd;, &smbd;, &winbindd;. &nmbd; is the name server message daemon,
&smbd; is the server message daemon, &winbindd; is the daemon that
handles communication with Domain Controllers.
</para>

<para>
If your system is NOT running as a WINS server, then there will be one (1) single instance of
 &nmbd; running on your system. If it is running as a WINS server then there will be
two (2) instances - one to handle the WINS requests.
</para>

<para>
&smbd; handles ALL connection requests and then spawns a new process for each client
connection made. That is why you are seeing so many of them, one (1) per client connection.
</para>

<para>
&winbindd; will run as one or two daemons, depending on whether or not it is being
run in "split mode" (in which case there will be two instances).
</para>

</sect2>

	<sect2>
	<title>I'm getting "open_oplock_ipc: Failed to get local UDP socket for address 100007f. Error was Cannot assign requested" in the logs</title>
    <para>Your loopback device isn't working correctly. Make sure it's running.  </para>
	</sect2>

</sect1>

</chapter>
