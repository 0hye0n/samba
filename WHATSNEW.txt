Release Announcements
=====================

This is the first preview release of Samba 4.9.  This is *not*
intended for production environments and is designed for testing
purposes only.  Please report any defects via the Samba bug reporting
system at https://bugzilla.samba.org/.

Samba 4.9 will be the next version of the Samba suite.


UPGRADING
=========


NEW FEATURES/CHANGES
====================


net ads setspn
---------------

There is a new 'net ads setspn' sub command for managing Windows SPN(s)
on the AD. This command aims to give the basic functionaility that is
provided on windows by 'setspn.exe' e.g. ability to add, delete and list
Windows SPN(s) stored in a Windows AD Computer object.

The format of the command is:

net ads setspn list [machine]
net ads setspn [add | delete ] SPN [machine]

'machine' is the name of the computer account on the AD that is to be managed.
If 'machine' is not specified the name of the 'client' running the command
is used instead.

The format of a Windows SPN is
  'serviceclass/host:port/servicename' (servicename and port are optional)

serviceclass/host is generally sufficient to specify a host based service.

net ads keytab changes
----------------------
net ads keytab add no longer attempts to convert the passed serviceclass
(e.g. nfs, html etc.) into a Windows SPN which is added to the Windows AD
computer object. By default just the keytab file is modified.

A new keytab subcommand 'add_update_ads' has been added to preserve the
legacy behaviour. However the new 'net ads setspn add' subcommand should
really be used instead.

net ads keytab create no longer tries to generate SPN(s) from existing
entries in a keytab file. If it is required to add Windows SPN(s) then
'net ads setspn add' should be used instead.

Local authorization plugin for MIT Kerberos
-------------------------------------------

This plugin controls the relationship between Kerberos principals and AD
accounts through winbind. The module receives the Kerberos principal and the
local account name as inputs and can then check if they match. This can resolve
issues with canonicalized names returned by Kerberos within AD. If the user
tries to log in as 'alice', but the samAccountName is set to ALICE (uppercase),
Kerberos would return ALICE as the username. Kerberos would not be able to map
'alice' to 'ALICE' in this case and auth would fail.  With this plugin account
names can be correctly mapped. This only applies to GSSAPI authentication,
not for the geting the initial ticket granting ticket.

Database audit support
----------------------

Changes to the Samba AD's sam.ldb database are now logged to Samba's debug log
under the "dsdb_audit" debug class and "dsdb_json_audit" for JSON formatted log
entries.

Transaction commits and roll backs are now logged to Samba's debug logs under
the "dsdb_transaction_audit" debug class and "dsdb_transaction_json_audit" for
JSON formatted log entries.

Password change audit support
-----------------------------

Password changes in the AD DC are now logged to Samba's debug logs under the
"dsdb_password_audit" debug class and "dsdb_password_json_audit" for JSON
formatted log entries.

Group membership change audit support
-------------------------------------

Group membership changes on the AD DC are now logged to
Samba's debug log under the "dsdb_group_audit" debug class and
"dsdb_group_json_audit" for JSON formatted log entries.

Log Authentication duration
---------------------------

For NTLM and Kerberos KDC authentication, the authentication duration is now
logged. Note that the duration is only included in the JSON formatted log
entries.

New Experimental LMDB LDB backend
---------------------------------

A new experimental LDB backend using LMBD is now available. This allows
databases larger than 4Gb (Currently the limit is set to 6Gb, but this will be
increased in a future release). To enable lmdb, provision or join a domain using
the --backend-store=mdb option.

This requires that a version of lmdb greater than 0.9.16 is installed and that
samba has not been built with the --without-ldb-lmdb option.

Please note this is an experimental feature and is not recommended for
production deployments.

Password Settings Objects
-------------------------
Support has been added for Password Settings Objects (PSOs). This AD feature is
also known as Fine-Grained Password Policies (FGPP).

PSOs allow AD administrators to override the domain password policy settings
for specific users, or groups of users. For example, PSOs can force certain
users to have longer password lengths, or relax the complexity constraints for
other users, and so on. PSOs can be applied to groups or to individual users.
When multiple PSOs apply to the same user, essentially the PSO with the best
precedence takes effect.

PSOs can be configured and applied to users/groups using the 'samba-tool domain
passwordsettings pso' set of commands.

Domain backup and restore
-------------------------
A new samba-tool command has been added that allows administrators to create a
backup-file of their domain DB. In the event of a catastrophic failure of the
domain, this backup-file can be used to restore Samba services.

The new 'samba-tool domain backup online' command takes a snapshot of the
domain DB from a given DC. In the event of a catastrophic DB failure, all DCs
in the domain should be taken offline, and the backup-file can then be used to
recreate a fresh new DC, using the 'samba-tool domain backup restore' command.
Once the backed-up domain DB has been restored on the new DC, other DCs can
then subsequently be joined to the new DC, in order to repopulate the Samba
network.

Domain rename tool
------------------
Basic support has been added for renaming a Samba domain. The rename feature is
designed for the following cases:
1). Running a temporary alternate domain, in the event of a catastrophic
failure of the regular domain. Using a completely different domain name and
realm means that the original domain and the renamed domain can both run at the
same time, without interfering with each other. This is an advantage over
creating a regular 'online' backup - it means the renamed/alternate domain can
provide core Samba network services, while trouble-shooting the fault on the
original domain can be done in parallel.
2). Creating a realistic lab domain or pre-production domain for testing.

Note that the renamed tool is currently not intended to support a long-term
rename of the production domain. Currently renaming the GPOs is not supported
and would need to be done manually.

The domain rename is done in two steps: first, the 'samba-tool domain backup
rename' command will clone the domain DB, renaming it in the process, and
producing a backup-file. Then, the 'samba-tool domain backup restore' command
takes the backup-file and restores the renamed DB to disk on a fresh DC.

New samba-tool options for diagnosing DRS replication issues
------------------------------------------------------------

The 'samba-tool drs showrepl' command has two new options controlling
the output. With --summary, the command says very little when DRS
replication is working well. With --json, JSON is produced. These
options are intended for human and machine audiences, respectively.

The 'samba-tool visualize uptodateness' visualizes replication lag as
a heat-map matrix based on the DRS uptodateness vectors. This will
show you if (but not why) changes are failing to replicate to some DCs.

REMOVED FEATURES
================



smb.conf changes
================

As the most popular Samba install platforms (Linux and FreeBSD) both
support extended attributes by default, the parameters "map readonly",
"store dos attributes" and "ea support" have had their defaults changed
to allow better Windows fileserver compatibility in a default install.

  Parameter Name                     Description             Default
  --------------                     -----------             -------
  map readonly                       Default changed              no
  store dos attributes               Default changed             yes
  ea support                         Default changed             yes

VFS interface changes
=====================

The VFS ABI interface version has changed to 39. Function changes
are:

SMB_VFS_FSYNC: Removed: Only async versions are used.
SMB_VFS_READ: Removed: Only PREAD or async versions are used.
SMB_VFS_WRITE: Removed: Only PWRITE or async versions are used.
SMB_VFS_CHMOD_ACL: Removed: Only CHMOD is used.
SMB_VFS_FCHMOD_ACL: Removed: Only FCHMOD is used.

Any external VFS modules will need to be updated to match these
changes in order to work with 4.9.x.

KNOWN ISSUES
============

https://wiki.samba.org/index.php/Release_Planning_for_Samba_4.9#Release_blocking_bugs


#######################################
Reporting bugs & Development Discussion
#######################################

Please discuss this release on the samba-technical mailing list or by
joining the #samba-technical IRC channel on irc.freenode.net.

If you do report problems then please try to send high quality
feedback. If you don't provide vital information to help us track down
the problem then you will probably be ignored.  All bug reports should
be filed under the Samba 4.1 and newer product in the project's Bugzilla
database (https://bugzilla.samba.org/).


======================================================================
== Our Code, Our Bugs, Our Responsibility.
== The Samba Team
======================================================================

