Release Announcements
=====================

This is the third release candidate of Samba 4.1.  This is *not*
intended for production environments and is designed for testing
purposes only.  Please report any defects via the Samba bug reporting
system at https://bugzilla.samba.org/.

Samba 4.1 will be the next version of the Samba suite and includes
all the technology found in both the Samba4 series and the stable 3.x
series. The primary additional features over Samba 3.6 are
support for the Active Directory logon protocols used by Windows 2000
and above.

If you are upgrading, or looking to develop, test or deploy Samba 4.1
releases candidates, you should backup all configuration and data.


NEW FEATURES
============

Client tools support SMB2/3
===========================

Samba 4.1.0 contains the first release of our client tools
and client library that work over the new protocols SMB2 or SMB3.
Note that SMB3 only works either to a Samba server version 4.0.0
or above, or to a Windows Server running Windows 2012 or Windows 8.

The default protocol for smbclient and smbcacls is still
SMB1 (the NT1 protocol dialect). An SMB2 or SMB3 connection
can be selected in one of two ways. The easiest way to test
the new protocol connection is to add the -mMAX_PROTOCOL
command line switch to either smbclient or smbcacls.

For example, to connect using SMB3 with smbclient a user
would type:

smbclient //server/share -Uuser%password -mSMB3

Another example of connecting using SMB2 using smbcacls
would be:

smbcacls //server/share -Uuser%password -mSMB2 filename

Note that when connecting using SMB2 or SMB3 protocols
the UNIX extensions are no longer available inside the
smbclient command set. This is due to UNIX extensions
not yet being defined for the SMB2 or SMB3 protocols.

The second way to select SMB2 or SMB3 connections is to
set the "client max protocol" parameter in the [global]
section of your smb.conf.

Setting this parameter will cause all client connections
from Samba and its client tools to offer the requested
max protocol to a server on every connection request.

For example, to cause all client tools (including winbindd,
rpcclient, and the libsmbclient library) to attempt use SMB3
by default add the line:

client max protocol = SMB3

to the [global] section of your smb.conf. This has not
been as widely tested as the -mPROTOCOL options, but
is intended to work correctly in the final release of
4.1.0.

Encrypted transport
===================

Although Samba servers have supported encrypted transport
connections using the UNIX extensions for many years,
selecting SMB3 transport allows encrypted transport
connections to Windows servers that support SMB3, as
well as Samba servers.

In order to enable this, add the "-e" option to the
smbclient command line.

For example, to connect to a Windows 2012 server over
SMB3 and select an encrypted transport you would use
the following command line:

smbclient //Win2012Server/share -Uuser%password -mSMB3 -e


Directory database replication (AD DC mode)
===========================================

Directory replication has been reworked in order to improve the
correctness and efficiency.
As a net effect of it, replication with other domain controllers with
a heavily modified schema is now possible (ie. Windows 2012 DCs or
other Windows DC with exchange installed) and replication didn't fail
anymore in such environments.


Server-Side Copy Support
========================

Samba 4.1.0 adds support for server-side copy operations via the SMB2
FSCTL_SRV_COPYCHUNK request. Clients making use of server-side copy
support, such as Windows Server 2012, should experience considerable
performance improvements for file copy operations, as file data need not
traverse the network.
This feature is enabled by default on the smbd file server.


Btrfs Filesystem Integration
============================

The Btrfs VFS module provided with Samba 4.1.0 further improves the
performance of server-side copy operations on shares backed by a Btrfs
filesystem. It does so by allowing multiple files to share the same
on-disk extents, avoiding the unnecessary duplication of source and
destination file data during a server-side copy operation.

This feature can be explicitly enabled on smbd shares backed by a Btrfs
filesystem with the smb.conf parameter:
vfs objects = btrfs


REMOVED COMPONENTS
==================

The Samba Web Administration Tool (SWAT) has been removed.


######################################################################
Changes
#######

smb.conf changes
----------------

   Parameter Name			Description	Default
   --------------			-----------	-------

   acl allow execute always		New		False
   password level			Removed
   set directory			Removed
   use ntdb				New		No


RUNNING Samba 4.1 as an AD DC
=============================

A short guide to setting up Samba as an AD DC can be found on the wiki:

  https://wiki.samba.org/index.php/Samba_AD_DC_HOWTO


COMMIT HIGHLIGHTS
=================

o   Jeremy Allison <jra@samba.org>
    * Add SMB2 and SMB3 support for client tools and client library.
    * Add support for SMB3 Encrypted transport.


o   David Disseldorp <ddiss@samba.org>
    * Add vfs_btrfs module.
    * Add support for server-side copy operations via the
      SMB2 FSCTL_SRV_COPYCHUNK request.


CHANGES SINCE 4.1.0rc3
======================

o   Michael Adam <obnox@samba.org>
    * BUG 10134: Add "acl allow execute always" parameter.


o   Volker Lendecke <vl@samba.org>
    * BUG 10008: dbwrap_ctdb: Treat empty records as non-existing.


CHANGES SINCE 4.1.0rc2
======================

o   Michael Adam <obnox@samba.org>
    * BUG 10107: Fix Winbind crashes on DC with trusted AD domains.


o   Jeremy Allison <jra@samba.org>
    * BUG 5917: Fix working on site with Read Only Domain Controller.
    * BUG 9974: Add SMB2 and SMB3 support for smbclient.
    * BUG 10063: Fix memory leak in source3/lib/util.c:1493.
    * BUG 10121: Masks incorrectly applied to UNIX extension permission
      changes.


o   Christian Ambach <ambi@samba.org>
    * BUG 9911: Build Samba 4.0.x on AIX with IBM XL C/C++.


o   Andrew Bartlett <abartlet@samba.org>
    * BUG 9091: When replicating DNS for bind9_dlz we need to create the
      server-DNS account remotely.


o   Günther Deschner <gd@samba.org>
    * BUG 9615: Winbind unable to retrieve user information from AD.
    * BUG 9899: winbind_lookup_names() fails because of
      NT_STATUS_CANT_ACCESS_DOMAIN_INFO.
    * BUG 10107: Fix Winbind crashes on DC with trusted AD domains.


o   Volker Lendecke <vl@samba.org>
    * BUG 10086: smbd: Fix async echo handler forking.
    * BUG 10106: Honour output buffer length set by the client for SMB2 GetInfo
      requests.
    * BUG 10114: Handle Dropbox (write-only-directory) case correctly
      in pathname lookup.


o   Stefan Metzmacher <metze@samba.org>
    * BUG 10030: ::1 added to nameserver on join.


o   Rusty Russell <rusty@rustcorp.com.au>
    * BUG 10000: Add man pages for ntdb tools.


o   Karolin Seeger <kseeger@samba.org>
    * BUG 7364: Add man page for vfs_syncops.
    * BUG 7490: Add man page for vfs_linux_xfs_sgid.
    * BUG 10001: Add man page for samba-regedit tool.
    * BUG 10076: Fix variable list in vfs_crossrename man page.


o   Andreas Schneider <asn@samba.org>
    * BUG 10073: Fix segmentation fault in 'net ads join'.
    * BUG 10082: s3-winbind: Fix a segfault passing NULL to a fstring argument.


o   Richard Sharpe <realrichardsharpe@gmail.com>
    * BUG 10097: MacOSX 10.9 will not follow path-based DFS referrals handed
      out by Samba.


o   Ralph Wuerthner <ralph.wuerthner@de.ibm.com>
    * BUG 10106: Honour output buffer length set by the client for SMB2 GetInfo
      requests.


CHANGES SINCE 4.1.0rc1
======================

o   Jeremy Allison <jra@samba.org>
    * BUG 9992: Windows error 0x800700FE when copying files with xattr names
      containing ":".
    * BUG 10010: Missing integer wrap protection in EA list reading can cause
      server to loop with DOS (CVE-2013-4124).
    * BUG 10064: Linux kernel oplock breaks can miss signals.


o   Andrew Bartlett <abartlet@samba.org>
    * BUG 9029: Fix replication with --domain-crictical-only to fill in
      backlinks.
    * BUG 9820: Fix crash of winbind after "ls -l
      /usr/local/samba/var/locks/sysvol".
    * BUG 10056: dsdb improvements.


o   Björn Baumbach <bb@sernet.de>
    * BUG 10003: Fix segfault while reading incomplete session info.


o   Gregor Beck <gbeck@sernet.de>
    * BUG 9678: Windows 8 Roaming profiles fail.


o   Günther Deschner <gd@samba.org>
    * BUG 10043: Allow to change the default location for Kerberos credential
      caches.


o   Volker Lendecke <vl@samba.org>
    * BUG 10013: Fix a 100% loop at shutdown time (smbd).


o   Stefan Metzmacher <metze@samba.org>
    * BUG 9820: Fix crash of winbind after "ls -l
      /usr/local/samba/var/locks/sysvol".
    * BUG 10015: Fix/improve debug options.
    * BUG 10042: Fix crashes in socket_get_local_addr().
    * BUG 10056: dsdb improvements.


o   Andreas Schneider <asn@samba.org>
    * BUG 9994: Do not delete an existing valid credential cache (s3-winbind).
    * BUG 10040: Rename regedit to samba-regedit.
    * BUG 10041: Remove obsolete swat manpage and references.
    * BUG 10048: nsswitch: Add OPT_KRB5CCNAME to avoid an error message.


o   Alexander Werth <alexander.werth@de.ibm.com>
    * BUG 10045: Remove a redundant inlined substitution of ACLs.


o   Ralph Wuerthner <ralphw@de.ibm.com>
    * BUG 10064: Linux kernel oplock breaks can miss signals.


#######################################
Reporting bugs & Development Discussion
#######################################

Please discuss this release on the samba-technical mailing list or by
joining the #samba-technical IRC channel on irc.freenode.net.

If you do report problems then please try to send high quality
feedback. If you don't provide vital information to help us track down
the problem then you will probably be ignored.  All bug reports should
be filed under the Samba 4.1 product in the project's Bugzilla
database (https://bugzilla.samba.org/).


======================================================================
== Our Code, Our Bugs, Our Responsibility.
== The Samba Team
======================================================================

