#!/bin/sh
# Copyright (C) 1998 John H Terpstra, 2000 Klaus Singvogel
#
SPECDIR=${SPECDIR:-/usr/src/OpenLinux/SPECS}
SRCDIR=${SRCDIR:-/usr/src/OpenLinux/SOURCES}
USERID=`id -u`
GRPID=`id -g`
devel=0;
old=0;

# Do some argument parsing...
if [ z$1 = z"devel" ]; then
	devel=1;
	shift
fi
if [ z$1 = z"old" ]; then
	old=1;
	shift
fi

# Start preparing the packages...
if [ $devel -ne 0 ]; then
        ( cd ../../../.. ; chown -R ${USERID}.${GRPID} samba; mv samba samba-PVERSION )
        ( cd ../../../.. ; tar czvf ${SRCDIR}/samba-PVERSION.tar.gz samba-PVERSION; mv samba-PVERSION samba )
else
        ( cd ../../../.. ; chown -R ${USERID}.${GRPID} samba-PVERSION )
        ( cd ../../../.. ; tar czvf ${SRCDIR}/samba-PVERSION.tar.gz samba-PVERSION )
fi

cp -af *.spec *.spec-lsb $SPECDIR
if [ -x *.patch ]; then
	for src in *.patch; do
	  trg=`echo $src | sed 's;xxxxxx;PVERSION;'`
	  cp -a $src $SRCDIR/$trg
	done
fi

# Start building the package
cd $SPECDIR
if [ $old -eq 0 ]; then
mv -f samba2.spec samba2.spec-nonlsb
ln -f samba2.spec-lsb samba2.spec
fi
rpm -ba -v samba2.spec
