#! /bin/sh

echo "fixing distribution in $1..."

cd $1

ver=`sed -n 's/AM_INIT_AUTOMAKE(.*,\(.*\))/\1/p' configure.in`
M="*   This is version $ver.   *"
echo "$M" | sed -e 's/./*/'
echo "$M"
echo "$M" | sed -e 's/./*/'

ed -s configure.in << END
/test -z/s,^,#,
w
q
END
aclocal -I cf
autoconf
autoheader
automake
(cd doc; makeinfo heimdal.texi)
for i in krb5 hdb; do (cd lib/$i; perl ../../cf/make-proto.pl \
	-o $i-protos.h -p $i-private.h `perl -e '
	do { 
		$_ = <>; 
	} until(/lib'$i'_la_SOURCES/); 
	while(/\\\\\s*$/s){ 
		$_ = $_ . <>;
	} 
	s/\n//g; 
	s/\\\\//g; 
	s/.*=//; 
	s/\s+/ /g; 
	print;' Makefile.in`)
done
rm fix-export make-release make-release.el
find . -name .cvsignore -print | xargs rm
