import Options
from dynconfig import *

def set_options(opt):
    # get all the basic GNU options from the gnu_dirs tool
    opt.tool_options('gnu_dirs')
    for option in dir_options.keys():
        default = dir_options[option][0]
        help    = dir_options[option][1]
        varname = get_varname(option)
        opt.add_option('--%s' % option,
                       help=(help + ' [%s]' % default),
                       action="store", dest=varname, default=default)

def configure(conf):
    # get all the basic GNU options from the gnu_dirs tool
    conf.check_tool('gnu_dirs')
    for option in dir_options.keys():
        varname = get_varname(option)
        value = getattr(Options.options, varname, None)
        conf.ASSERT(value is not None, "Missing configure option %s" % varname)
        conf.ASSERT(varname not in conf.env, "Variable %s already defined" % varname)
        conf.env[varname] = value

def build(bld):
    cflags = dynconfig_cflags(bld)
    bld.SAMBA_SUBSYSTEM('DYNCONFIG',
                        '../dynconfig.c',
                        deps='replace talloc tdb',
                        cflags=cflags)
