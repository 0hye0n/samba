#!/usr/bin/env python

from samba_utils import *

TDB_LIB_SRC = '''lib/util_tdb.c ../lib/util/util_tdb.c
          lib/dbwrap.c lib/dbwrap_tdb.c
          lib/dbwrap_ctdb.c
          lib/g_lock.c
          lib/dbwrap_rbt.c'''

TDB_VALIDATE_SRC = '''lib/tdb_validate.c'''

SMBLDAP = bld.env.SMBLDAP or ""
SMBLDAPUTIL = bld.env.SMBLDAPUTIL or ""

SMBLDAP_SRC = '''${SMBLDAP} ${SMBLDAPUTIL}'''

VERSION_SRC = '''lib/version.c'''

WBCOMMON_SRC = '../nsswitch/wb_common.c'

AFS_SRC = 'lib/afs.c'

AFS_SETTOKEN_SRC = 'lib/afs_settoken.c'

AVAHI_SRC = 'lib/avahi.c smbd/avahi_register.c'

SERVER_MUTEX_SRC = 'lib/server_mutex.c'

PASSCHANGE_SRC = '''libsmb/passchange.c'''

LIBNDR_DRSUAPI_SRC = '''../librpc/ndr/ndr_drsuapi.c
                     ../librpc/ndr/ndr_compression.c
                     ../librpc/gen_ndr/ndr_drsuapi.c
                     ../librpc/ndr/ndr_drsblobs.c
                     ../librpc/gen_ndr/ndr_drsblobs.c'''

COMPRESSION_SRC = '../lib/compression/mszip.c ../lib/compression/lzxpress.c'

DRSUAPI_SRC = '''${LIBNDR_DRSUAPI_SRC}
              ${COMPRESSION_SRC}'''

LIBNDR_NTLMSSP_SRC = '''../librpc/gen_ndr/ndr_ntlmssp.c
                     ../librpc/ndr/ndr_ntlmssp.c'''

LIBNDR_SRC = '''../librpc/ndr/ndr_basic.c
             ../librpc/ndr/ndr.c
             ../librpc/ndr/ndr_misc.c
             ../librpc/gen_ndr/ndr_misc.c
             ../librpc/ndr/ndr_string.c
             ../librpc/ndr/uuid.c
             librpc/ndr/util.c'''

LIBNDR_GEN_SRC0 = '''../librpc/gen_ndr/ndr_samr.c'''

LIBNDR_NETLOGON_SRC = '''../librpc/gen_ndr/ndr_netlogon.c
                  ../librpc/ndr/ndr_netlogon.c'''

LIBNDR_SCHANNEL_SRC = '''../librpc/gen_ndr/ndr_schannel.c
                  ../librpc/ndr/ndr_schannel.c'''

LIBNDR_SPOOLSS_SRC = '''../librpc/gen_ndr/ndr_spoolss.c
                  ../librpc/ndr/ndr_spoolss_buf.c'''

LIBNDR_NTPRINTING_SRC = '''../librpc/gen_ndr/ndr_ntprinting.c
                           ../librpc/ndr/ndr_ntprinting.c'''

LIBNDR_PREG_SRC = '''librpc/gen_ndr/ndr_preg.c
                     librpc/ndr/ndr_preg.c'''

LIBNDR_XATTR_SRC = '''../librpc/gen_ndr/ndr_xattr.c
                  ../librpc/ndr/ndr_xattr.c'''

LIBCLI_SPOOLSS_SRC = '''
                     ../librpc/gen_ndr/cli_spoolss.c
                     ../librpc/gen_ndr/ndr_spoolss_c.c
                     rpc_client/cli_spoolss.c
                     rpc_client/init_spoolss.c'''

LIBCLI_EVENTLOG_SRC = '''
                      ../librpc/gen_ndr/cli_eventlog.c
                      ../librpc/gen_ndr/ndr_eventlog_c.c'''

LIBCLI_WINREG_SRC = '''
                    ../librpc/gen_ndr/cli_winreg.c
                    ../librpc/gen_ndr/ndr_winreg_c.c'''

LIBCLI_NTSVCS_SRC = '''
                    ../librpc/gen_ndr/cli_ntsvcs.c
                    ../librpc/gen_ndr/ndr_ntsvcs_c.c'''

LIBCLI_DRSUAPI_SRC = '''
                     ../librpc/gen_ndr/cli_drsuapi.c
                     ../librpc/gen_ndr/ndr_drsuapi_c.c'''

LIBCLI_DFS_SRC = '''
                 ../librpc/gen_ndr/cli_dfs.c
                 ../librpc/gen_ndr/ndr_dfs_c.c'''

LIBCLI_ECHO_SRC = '''
                  ../librpc/gen_ndr/cli_echo.c
                  ../librpc/gen_ndr/ndr_echo_c.c'''

LIBCLI_INITSHUTDOWN_SRC = '''
                          ../librpc/gen_ndr/cli_initshutdown.c
                          ../librpc/gen_ndr/ndr_initshutdown_c.c'''

LIBCLI_DSSETUP_SRC = '''
                     ../librpc/gen_ndr/cli_dssetup.c
                     ../librpc/gen_ndr/ndr_dssetup_c.c'''

LIBCLI_SVCCTL_SRC = '''
                    ../librpc/gen_ndr/cli_svcctl.c
                    ../librpc/gen_ndr/ndr_svcctl_c.c'''

LIBCLI_WKSSVC_SRC = '''
                    ../librpc/gen_ndr/cli_wkssvc.c
                    ../librpc/gen_ndr/ndr_wkssvc_c.c'''

LIBCLI_SRVSVC_SRC = '''
                    ../librpc/gen_ndr/cli_srvsvc.c
                    ../librpc/gen_ndr/ndr_srvsvc_c.c'''

LIBCLI_LSA_SRC = '''
                 ../librpc/gen_ndr/cli_lsa.c
                 ../librpc/gen_ndr/ndr_lsa_c.c
                 rpc_client/cli_lsarpc.c
                 rpc_client/init_lsa.c'''

LIBCLI_SAMR_SRC = '''
                  ../librpc/gen_ndr/cli_samr.c
                  ../librpc/gen_ndr/ndr_samr_c.c
                  rpc_client/cli_samr.c'''

LIBCLI_NETLOGON_SRC = '''
                      ../librpc/gen_ndr/cli_netlogon.c
                      ../librpc/gen_ndr/ndr_netlogon_c.c
                      rpc_client/cli_netlogon.c'''

LIBCLI_EPMAPPER_SRC = '''
                      ../librpc/gen_ndr/cli_epmapper.c
                      ../librpc/gen_ndr/ndr_epmapper_c.c'''

LIBNDR_GEN_SRC = '''../librpc/gen_ndr/ndr_wkssvc.c
                 ${LIBNDR_GEN_SRC0}
                 ../librpc/gen_ndr/ndr_dfs.c
                 ../librpc/gen_ndr/ndr_echo.c
                 ../librpc/gen_ndr/ndr_winreg.c
                 ../librpc/gen_ndr/ndr_initshutdown.c
                 ../librpc/gen_ndr/ndr_srvsvc.c
                 ${LIBNDR_NETLOGON_SRC}
                 ../librpc/gen_ndr/ndr_dssetup.c
                 ../librpc/gen_ndr/ndr_epmapper.c
                 ../librpc/gen_ndr/ndr_ntsvcs.c
                 ${LIBNDR_SPOOLSS_SRC}'''

# this includes only the low level parse code, not stuff
# that requires knowledge of security contexts
REG_PARSE_PRS_SRC = '''registry/reg_parse_prs.c'''

LIBREPLACE_SRC = '''${LIBREPLACE_SRCS}'''

SOCKET_WRAPPER_SRC = '''${SOCKET_WRAPPER_SRCS}'''
NSS_WRAPPER_SRC = '''${NSS_WRAPPER_SRCS}'''

LIBSAMBAUTIL_SRC = '''
                ${LIBREPLACE_SRC}
                ${SOCKET_WRAPPER_SRC}
                ${NSS_WRAPPER_SRC}'''

UTIL_SRC = '''../lib/util/rbtree.c ../lib/util/signal.c ../lib/util/time.c
                   ../lib/util/xfile.c ../lib/util/util_strlist.c
                   ../lib/util/util_file.c ../lib/util/data_blob.c
                   ../lib/util/util.c ../lib/util/fsusage.c
                   ../lib/util/params.c ../lib/util/talloc_stack.c
                   ../lib/util/genrand.c ../lib/util/util_net.c
                   ../lib/util/become_daemon.c ../lib/util/system.c
                   ../lib/util/tevent_unix.c ../lib/util/tevent_ntstatus.c
                   ../lib/util/smb_threads.c ../lib/util/util_id.c
                   ../lib/util/blocking.c ../lib/util/rfc1738.c '''

LIBTEVENT_SRC0 = ''

PTHREADPOOL_SRC = ''

LIBREPLACE_SRCS = ''

SOCKET_WRAPPER_SRCS = ''

NSS_WRAPPER_SRCS = ''

ZLIB_SRCS = ''

LIB_SRC = '''${LIBSAMBAUTIL_SRC} ${UTIL_SRC}
          lib/messages.c librpc/gen_ndr/ndr_messaging.c lib/messages_local.c
          lib/messages_ctdbd.c lib/packet.c lib/ctdbd_conn.c
          lib/interfaces.c lib/memcache.c
          lib/talloc_dict.c
          lib/util_sconn.c
          lib/serverid.c
          lib/util_transfer_file.c ../lib/async_req/async_sock.c
          ${TDB_LIB_SRC}
          ${VERSION_SRC} lib/charcnv.c lib/debug.c lib/fault.c
          lib/interface.c lib/pidfile.c
          lib/system.c lib/sendfile.c lib/recvfile.c lib/time.c
          lib/username.c
          ../libds/common/flag_mapping.c
          lib/util_pw.c lib/access.c lib/smbrun.c
          lib/bitmap.c lib/dprintf.c ${UTIL_REG_SRC}
          lib/wins_srv.c
          lib/util_str.c lib/clobber.c lib/util_sid.c
          lib/util_unistr.c lib/util_file.c
          lib/util.c lib/util_names.c
          lib/util_sock.c lib/sock_exec.c lib/util_sec.c
          lib/substitute.c lib/dbwrap_util.c
          lib/ms_fnmatch.c lib/select.c lib/errmap_unix.c
          lib/tallocmsg.c lib/dmallocmsg.c
          libsmb/clisigning.c libsmb/smb_signing.c
          lib/iconv.c lib/pam_errors.c intl/lang_tdb.c
          lib/conn_tdb.c lib/adt_tree.c lib/gencache.c
          lib/sessionid_tdb.c
          lib/module.c lib/events.c ${LIBTEVENT_SRC0}
          lib/server_contexts.c
          lib/ldap_escape.c ${CHARSET_STATIC}
          lib/secdesc.c lib/util_seaccess.c ../libcli/security/secace.c
          ../libcli/security/sddl.c
          ../libcli/security/secacl.c ${PTHREADPOOL_SRC}
          lib/fncall.c
          libads/krb5_errs.c lib/system_smbd.c lib/audit.c
          lib/file_id.c lib/idmap_cache.c
          ../libcli/security/dom_sid.c ../libcli/security/security_descriptor.c'''

LIB_DUMMY_SRC = '''lib/dummysmbd.c lib/dummyroot.c'''
LIB_NONSMBD_SRC = '''${LIB_DUMMY_SRC}'''

READLINE_SRC = '''lib/readline.c'''

POPT_LIB_SRC = '''lib/popt_common.c'''

PARAM_WITHOUT_REG_SRC = '''param/loadparm.c param/util.c param/loadparm_server_role.c
                           lib/sharesec.c lib/ldap_debug_handler.c'''
PARAM_REG_ADD_SRC = '''${REG_SMBCONF_SRC} ${LIBSMBCONF_SRC} ${PRIVILEGES_BASIC_SRC}'''
PARAM_SRC = '''${PARAM_REG_ADD_SRC}'''

KRBCLIENT_SRC = '''libads/kerberos.c libads/ads_status.c'''

LIBADDNS_SRC0 = '''libaddns/dnsrecord.c libaddns/dnsutils.c  libaddns/dnssock.c
               libaddns/dnsgss.c libaddns/dnsmarshall.c'''
LIBADDNS_SRC = '''${LIBADDNS_SRC0} ${SOCKET_WRAPPER_SRC}'''

GPEXT_STATIC = ''
GPEXT_REGISTRY_SRC = 'libgpo/gpext/registry.c'
GPEXT_SCRIPTS_SRC = 'libgpo/gpext/scripts.c'
GPEXT_SECURITY_SRC = 'libgpo/gpext/security.c'

GPEXT_SRC = '''../libgpo/gpext/gpext.c ${GPEXT_STATIC}'''

LIBGPO_SRC0 = '''../libgpo/gpo_ldap.c ../libgpo/gpo_ini.c ../libgpo/gpo_util.c
              ../libgpo/gpo_fetch.c libgpo/gpo_filesync.c ../libgpo/gpo_sec.c
              libgpo/gpo_reg.c
              ${GPEXT_SRC}'''
LIBGPO_SRC = '''${LIBGPO_SRC0}'''

LIBADS_SRC = '''libads/ldap.c
             libads/sasl.c libads/sasl_wrapping.c
             libads/krb5_setpw.c
             libads/kerberos_util.c
             libads/ldap_user.c
             libads/ads_struct.c libads/kerberos_keytab.c
             libads/disp_sec.c libads/ldap_utils.c
             libads/ldap_schema.c libads/util.c libads/ndr.c'''

LIBADS_SERVER_SRC = '''libads/kerberos_verify.c libads/authdata.c
                    ../librpc/ndr/ndr_krb5pac.c
                    ../librpc/gen_ndr/ndr_krb5pac.c'''

LIBADS_PRINTER_SRC = '''libads/ldap_printer.c'''

SECRETS_SRC = '''passdb/secrets.c passdb/machine_account_secrets.c
                 passdb/machine_sid.c librpc/gen_ndr/ndr_secrets.c'''

LIBNBT_SRC = '''../libcli/nbt/nbtname.c
             ../libcli/netlogon.c
             ../libcli/ndr_netlogon.c
             ../librpc/gen_ndr/ndr_nbt.c
             ../librpc/gen_ndr/ndr_svcctl.c
             ../librpc/ndr/ndr_svcctl.c'''

LIBNMB_SRC = '''libsmb/unexpected.c libsmb/namecache.c libsmb/nmblib.c
             libsmb/namequery.c ../libcli/nbt/lmhosts.c libsmb/conncache.c
             libads/dns.c libads/sitename_cache.c'''

NTERR_SRC = '''libsmb/nterr.c libsmb/smberr.c'''
DOSERR_SRC = '../libcli/util/doserr.c'
ERRORMAP_SRC = 'libsmb/errormap.c'
DCE_RPC_ERR_SRC = '../librpc/rpc/dcerpc_error.c'

LIBSMB_ERR_SRC0 = '''${NTERR_SRC} ${DOSERR_SRC} ${ERRORMAP_SRC} ${DCE_RPC_ERR_SRC}'''

LIBSMB_ERR_SRC1 = '''../libcli/auth/smbdes.c ../libcli/auth/smbencrypt.c ../libcli/auth/msrpc_parse.c ../libcli/auth/session.c'''

LIBSMB_ERR_SRC = '${LIBSMB_ERR_SRC0} ${LIBSMB_ERR_SRC1}'

LIBSMB_SRC0 = '''
               ../libcli/auth/ntlm_check.c
               libsmb/ntlmssp.c
               libsmb/ntlmssp_wrap.c
               ../libcli/auth/ntlmssp.c
               ../libcli/auth/ntlmssp_sign.c
               ${LIBNDR_NTLMSSP_SRC}
               ../libcli/auth/ntlmssp_ndr.c
               ../libcli/auth/ntlmssp_server.c'''

LIBSAMBA_SRC = '${LIBSMB_SRC0}'

LIBCLI_LDAP_MESSAGE_SRC = '''../libcli/ldap/ldap_message.c'''
LIBCLI_LDAP_NDR_SRC = '''../libcli/ldap/ldap_ndr.c lib/ldb_compat.c'''

CLDAP_SRC = '''libads/cldap.c
        ../libcli/cldap/cldap.c
        ../lib/util/idtree.c
        ${LIBCLI_LDAP_MESSAGE_SRC} ${LIBCLI_LDAP_NDR_SRC}'''

TLDAP_SRC = '''lib/tldap.c lib/tldap_util.c lib/util_tsock.c'''

SCHANNEL_SRC = '''../libcli/auth/credentials.c
               ../libcli/auth/schannel_sign.c
               ../libcli/auth/schannel_state_tdb.c
               ${LIBNDR_SCHANNEL_SRC}'''

LIBSMB_SRC = '''libsmb/clientgen.c libsmb/cliconnect.c libsmb/clifile.c
             libsmb/clikrb5.c libsmb/clispnego.c
             ../libcli/auth/spnego_parse.c
             libsmb/clirap.c libsmb/clierror.c libsmb/climessage.c
             libsmb/clireadwrite.c libsmb/clilist.c libsmb/cliprint.c
             libsmb/clitrans.c libsmb/clisecdesc.c libsmb/clidgram.c
             libsmb/clistr.c libsmb/cliquota.c libsmb/clifsinfo.c libsmb/clidfs.c
             libsmb/clioplock.c libsmb/clirap2.c
             libsmb/smb_seal.c libsmb/async_smb.c
             ${LIBNMB_SRC}
             ${LIBNBT_SRC}
             ${CLDAP_SRC}
             ${DRSUAPI_SRC}'''

LIBMSRPC_SRC = '''
               ${SCHANNEL_SRC}
               rpc_client/cli_pipe.c
               librpc/crypto/gse_krb5.c
               librpc/crypto/gse.c
               librpc/crypto/cli_spnego.c
               librpc/rpc/rpc_common.c
               rpc_client/rpc_transport_np.c
               rpc_client/rpc_transport_sock.c
               rpc_client/rpc_transport_tstream.c
               ../librpc/rpc/binding.c
               ../librpc/rpc/dcerpc_util.c
               librpc/rpc/dcerpc_helpers.c
               ../librpc/rpc/binding_handle.c
               ${LIBCLI_EPMAPPER_SRC}'''

#
# registry-related objects
#
UTIL_REG_SRC = '''../libcli/registry/util_reg.c'''

REG_INIT_BASIC_SRC = '''registry/reg_init_basic.c'''
REG_INIT_SMBCONF_SRC = '''registry/reg_init_smbconf.c'''
REG_INIT_FULL_SRC = '''registry/reg_init_full.c'''

REGFIO_SRC = '''registry/regfio.c ${REG_PARSE_PRS_SRC}'''

REG_API_REGF_SRC = '''registry/reg_api_regf.c'''

REGSRCS_SRC = '''registry/reg_objects.c'''

REG_BACKENDS_BASE_SRC = '''registry/reg_backend_db.c'''

REG_BACKENDS_SMBCONF_SRC = '''registry/reg_backend_smbconf.c'''

REG_BACKENDS_EXTRA_SRC = '''registry/reg_backend_printing.c
                         registry/reg_backend_shares.c
                         registry/reg_backend_netlogon_params.c
                         registry/reg_backend_prod_options.c
                         registry/reg_backend_tcpip_params.c
                         registry/reg_backend_hkpt_params.c
                         registry/reg_backend_current_version.c
                         registry/reg_backend_perflib.c'''

REG_BASE_SRC = '''registry/reg_api.c
               registry/reg_dispatcher.c
               registry/reg_cachehook.c
               ${REGSRCS_SRC}
               registry/reg_util_internal.c
               lib/util_nttoken.c
               ${REG_BACKENDS_BASE_SRC}
               ${REG_INIT_BASIC_SRC}'''

REG_SMBCONF_SRC = '''${REG_BASE_SRC}
                  ${REG_BACKENDS_SMBCONF_SRC}
                  ${REG_INIT_SMBCONF_SRC}
                  registry/reg_util_token.c
                  registry/reg_api_util.c'''

REG_FULL_SRC = '''${REG_SMBCONF_SRC}
               ${REG_BACKENDS_EXTRA_SRC}
               ${REG_INIT_FULL_SRC}
               registry/reg_eventlog.c
               registry/reg_perfcount.c
               librpc/gen_ndr/ndr_perfcount.c'''

LIB_EVENTLOG_SRC = '''lib/eventlog/eventlog.c'''

RPC_STATIC = ''

RPC_LSARPC_SRC = '''rpc_server/srv_lsa_nt.c
                    ../librpc/gen_ndr/srv_lsa.c'''

RPC_NETLOGON_SRC = '''rpc_server/srv_netlog_nt.c
                      ../librpc/gen_ndr/srv_netlogon.c'''

RPC_SAMR_SRC = '''rpc_server/srv_samr_nt.c
               rpc_server/srv_samr_util.c
               rpc_server/srv_samr_chgpasswd.c
               ../librpc/gen_ndr/srv_samr.c'''

RPC_INITSHUTDOWN_SRC = ''' ../librpc/gen_ndr/srv_initshutdown.c rpc_server/srv_initshutdown_nt.c'''

RPC_WINREG_SRC = '''rpc_server/srv_winreg_nt.c
                    ../librpc/gen_ndr/srv_winreg.c'''

RPC_DSSETUP_SRC = ''' rpc_server/srv_dssetup_nt.c ../librpc/gen_ndr/srv_dssetup.c'''

RPC_SRVSVC_SRC = '''rpc_server/srv_srvsvc_nt.c
                    ../librpc/gen_ndr/srv_srvsvc.c'''

RPC_WKSSVC_SRC = '''../librpc/gen_ndr/srv_wkssvc.c
                    rpc_server/srv_wkssvc_nt.c'''

RPC_SVCCTL_SRC = ''' rpc_server/srv_svcctl_nt.c
                  ../librpc/gen_ndr/srv_svcctl.c
                  services/svc_spoolss.c services/svc_rcinit.c services/services_db.c
                  services/svc_netlogon.c services/svc_winreg.c
                  services/svc_wins.c'''

RPC_NTSVCS_SRC = '''rpc_server/srv_ntsvcs_nt.c
                 ../librpc/gen_ndr/srv_ntsvcs.c'''

RPC_NETDFS_SRC = '''../librpc/gen_ndr/srv_dfs.c
                    rpc_server/srv_dfs_nt.c'''

RPC_SPOOLSS_SRC = '''rpc_server/srv_spoolss_nt.c
                     rpc_server/srv_spoolss_util.c
                  ../librpc/gen_ndr/srv_spoolss.c'''

RPC_EVENTLOG_SRC = '''rpc_server/srv_eventlog_nt.c
                   ../librpc/gen_ndr/srv_eventlog.c'''

NPA_TSTREAM_SRC = '''../libcli/named_pipe_auth/npa_tstream.c
                     ../librpc/gen_ndr/ndr_named_pipe_auth.c'''

RPC_NCACN_NP = '''rpc_server/srv_pipe_register.c rpc_server/rpc_ncacn_np.c
                  rpc_server/rpc_handles.c'''

RPC_SERVICE = '''rpc_server/rpc_server.c'''

RPC_CRYPTO = '''rpc_server/dcesrv_ntlmssp.c
                rpc_server/dcesrv_gssapi.c
                rpc_server/dcesrv_spnego.c'''

RPC_PIPE_SRC = '''rpc_server/srv_pipe_hnd.c rpc_server/srv_pipe.c
               ${RPC_NCACN_NP} ${RPC_SERVICE} ${RPC_CRYPTO}'''

RPC_RPCECHO_SRC = '''rpc_server/srv_echo_nt.c ../librpc/gen_ndr/srv_echo.c'''

RPC_SERVER_SRC = '''${RPC_PIPE_SRC} ${NPA_TSTREAM_SRC} ${RPC_STATIC}'''

RPC_CLIENT_SCHANNEL_SRC = '''rpc_client/cli_pipe_schannel.c'''

LOCKING_SRC = '''locking/locking.c locking/brlock.c locking/posix.c'''

PRIVILEGES_BASIC_SRC = '''../libcli/security/privileges.c'''

PRIVILEGES_SRC = '''lib/privileges.c'''

PASSDB_GET_SET_SRC = '''passdb/pdb_get_set.c'''

PASSDB_SRC = '''${PASSDB_GET_SET_SRC} passdb/passdb.c passdb/pdb_interface.c
                passdb/util_wellknown.c passdb/util_builtin.c passdb/pdb_compat.c
                passdb/util_unixsids.c passdb/lookup_sid.c
                passdb/login_cache.c
                passdb/account_pol.c ${PRIVILEGES_SRC}
                lib/util_nscd.c lib/winbind_util.c ${SERVER_MUTEX_SRC}'''
#FIXME: lib/winbind_util.c probably is not part of PASSDB_SRC

CHARSET_STATIC = ''
CHARSET_WEIRD_SRC = 'modules/weird.c'
CHARSET_CP850_SRC = 'modules/CP850.c'
CHARSET_CP437_SRC = 'modules/CP437.c'
CHARSET_MACOSXFS_SRC = 'modules/charset_macosxfs.c'

GROUPDB_SRC = '''groupdb/mapping.c groupdb/mapping_tdb.c'''

PROFILE_SRC = '''profile/profile.c'''
PROFILES_SRC = '''utils/profiles.c
               ${REGFIO_SRC}'''

OPLOCK_SRC = '''smbd/oplock.c smbd/oplock_irix.c smbd/oplock_linux.c
             smbd/oplock_onefs.c'''

NOTIFY_SRC = '''smbd/notify.c smbd/notify_inotify.c smbd/notify_internal.c
                librpc/gen_ndr/ndr_notify.c'''

FNAME_UTIL_SRC = '''smbd/filename_util.c'''


PLAINTEXT_AUTH_SRC = '''auth/pampass.c auth/pass_check.c'''

SLCACHE_SRC = '''libsmb/samlogon_cache.c'''

DCUTIL_SRC  = '''libsmb/namequery_dc.c libsmb/trustdom_cache.c libsmb/trusts_util.c libsmb/dsgetdcname.c'''

#FIXME: set IDMAP_STATIC during configuration
IDMAP_STATIC=''
IDMAP_RW_SRC = 'winbindd/idmap_rw.c'
IDMAP_SRC = 'winbindd/idmap.c winbindd/idmap_util.c ${IDMAP_RW_SRC} ${IDMAP_STATIC}'

#FIXME: set NSS_INFO_STATIC during configuration
NSS_INFO_STATIC = ''
NSS_INFO_TEMPLATE_SRC = 'winbindd/nss_info_template.c'
NSS_INFO_SRC = 'winbindd/nss_info.c'

IDMAP_AD_SRC = '''winbindd/idmap_ad.c'''
IDMAP_RID_SRC = '''winbindd/idmap_rid.c'''
IDMAP_PASSDB_SRC = '''winbindd/idmap_passdb.c'''
IDMAP_LDAP_SRC = '''winbindd/idmap_ldap.c'''
IDMAP_TDB2_SRC = '''winbindd/idmap_tdb2.c'''

IDMAP_HASH_SRC = '''winbindd/idmap_hash/idmap_hash.c
                    winbindd/idmap_hash/mapfile.c'''

IDMAP_ADEX_SRC = '''winbindd/idmap_adex/idmap_adex.c
                    winbindd/idmap_adex/cell_util.c
                    winbindd/idmap_adex/likewise_cell.c
                    winbindd/idmap_adex/provider_unified.c
                    winbindd/idmap_adex/gc_util.c
                    winbindd/idmap_adex/domain_util.c'''

PERFCOUNT_STATIC = ''
PERFCOUNT_ONEFS_SRC = 'modules/perfcount_onefs.c'
PERFCOUNT_TEST_SRC = 'modules/perfcount_test.c'

WINBINDD_SRC1 = '''winbindd/winbindd.c
                   winbindd/winbindd_group.c
                   winbindd/winbindd_util.c
                   winbindd/winbindd_cache.c
                   winbindd/winbindd_pam.c
                   winbindd/winbindd_misc.c
                   winbindd/winbindd_cm.c
                   winbindd/winbindd_wins.c
                   winbindd/winbindd_msrpc.c
                   winbindd/winbindd_rpc.c
                   winbindd/winbindd_reconnect.c
                   winbindd/winbindd_ads.c
                   winbindd/winbindd_samr.c
                   winbindd/winbindd_dual.c
                   winbindd/winbindd_dual_ndr.c
                   winbindd/winbindd_dual_srv.c
                   winbindd/winbindd_async.c
                   winbindd/winbindd_creds.c
                   winbindd/winbindd_cred_cache.c
                   winbindd/winbindd_ccache_access.c
                   winbindd/winbindd_domain.c
                   winbindd/winbindd_idmap.c
                   winbindd/winbindd_locator.c
                   winbindd/winbindd_ndr.c
                   winbindd/wb_ping.c
                   winbindd/wb_lookupsid.c
                   winbindd/wb_lookupname.c
                   winbindd/wb_sid2uid.c
                   winbindd/wb_sid2gid.c
                   winbindd/wb_uid2sid.c
                   winbindd/wb_gid2sid.c
                   winbindd/wb_queryuser.c
                   winbindd/wb_lookupuseraliases.c
                   winbindd/wb_lookupusergroups.c
                   winbindd/wb_getpwsid.c
                   winbindd/wb_gettoken.c
                   winbindd/wb_seqnum.c
                   winbindd/wb_seqnums.c
                   winbindd/wb_group_members.c
                   winbindd/wb_getgrsid.c
                   winbindd/wb_query_user_list.c
                   winbindd/wb_fill_pwent.c
                   winbindd/wb_next_pwent.c
                   winbindd/wb_next_grent.c
                   winbindd/wb_dsgetdcname.c
                   winbindd/winbindd_lookupsid.c
                   winbindd/winbindd_lookupname.c
                   winbindd/winbindd_sid_to_uid.c
                   winbindd/winbindd_sid_to_gid.c
                   winbindd/winbindd_uid_to_sid.c
                   winbindd/winbindd_gid_to_sid.c
                   winbindd/winbindd_allocate_uid.c
                   winbindd/winbindd_allocate_gid.c
                   winbindd/winbindd_getpwsid.c
                   winbindd/winbindd_getpwnam.c
                   winbindd/winbindd_getpwuid.c
                   winbindd/winbindd_getsidaliases.c
                   winbindd/winbindd_getuserdomgroups.c
                   winbindd/winbindd_getgroups.c
                   winbindd/winbindd_show_sequence.c
                   winbindd/winbindd_getgrgid.c
                   winbindd/winbindd_getgrnam.c
                   winbindd/winbindd_getusersids.c
                   winbindd/winbindd_lookuprids.c
                   winbindd/winbindd_setpwent.c
                   winbindd/winbindd_getpwent.c
                   winbindd/winbindd_endpwent.c
                   winbindd/winbindd_setgrent.c
                   winbindd/winbindd_getgrent.c
                   winbindd/winbindd_endgrent.c
                   winbindd/winbindd_dsgetdcname.c
                   winbindd/winbindd_getdcname.c
                   winbindd/winbindd_list_users.c
                   winbindd/winbindd_list_groups.c
                   winbindd/winbindd_check_machine_acct.c
                   winbindd/winbindd_change_machine_acct.c
                   winbindd/winbindd_ping_dc.c
                   winbindd/winbindd_pam_auth.c
                   winbindd/winbindd_pam_logoff.c
                   winbindd/winbindd_pam_chauthtok.c
                   winbindd/winbindd_pam_auth_crap.c
                   winbindd/winbindd_pam_chng_pswd_auth_crap.c
                   auth/auth_util.c
                   auth/token_util.c
                   auth/user_util.c
                   auth/check_samsec.c
                   auth/server_info.c
                   auth/server_info_sam.c
                   auth/user_info.c
                   auth/user_util.c
                   rpc_server/srv_samr_chgpasswd.c
                   ../nsswitch/libwbclient/wb_reqtrans.c'''

WINBINDD_SRC = '''${WINBINDD_SRC1}
                  ${IDMAP_SRC} ${NSS_INFO_SRC}
                  ${RPC_NCACN_NP} ${NPA_TSTREAM_SRC} ${RPC_SAMR_SRC} ${RPC_LSARPC_SRC}
                  ${TDB_VALIDATE_SRC}
                  ${LIBCLI_DSSETUP_SRC}
                  ${LIBCLI_LSA_SRC}
                  ${LIBCLI_SAMR_SRC}
                  ${LIBCLI_NETLOGON_SRC}
                  rpc_client/init_netlogon.c'''

MANGLE_SRC = '''smbd/mangle.c smbd/mangle_hash.c smbd/mangle_hash2.c'''

SMBD_SRC_MAIN = '''smbd/server.c smbd/server_exit.c'''

BUILDOPT_SRC = '''smbd/build_options.c'''

SMBD_SRC_SRV = '''smbd/server_reload.c smbd/files.c smbd/connection.c
               smbd/utmp.c smbd/session.c
               smbd/dfree.c smbd/dir.c smbd/password.c smbd/conn.c
               smbd/share_access.c smbd/fileio.c
               smbd/ipc.c smbd/lanman.c smbd/negprot.c
               smbd/message.c smbd/nttrans.c smbd/pipes.c
               smbd/reply.c smbd/sesssetup.c smbd/trans2.c smbd/uid.c
               smbd/dosmode.c smbd/filename.c smbd/open.c smbd/close.c
               smbd/blocking.c smbd/sec_ctx.c smbd/srvstr.c
               smbd/vfs.c smbd/perfcount.c smbd/statcache.c smbd/seal.c
               smbd/posix_acls.c lib/sysacls.c
               smbd/process.c smbd/service.c smbd/error.c
               printing/printspoolss.c
               lib/sysquotas.c lib/sysquotas_linux.c
               lib/sysquotas_xfs.c lib/sysquotas_4A.c
               lib/sysquotas_nfs.c
               smbd/fake_file.c
               smbd/quotas.c smbd/ntquotas.c smbd/msdfs.c
               smbd/aio.c smbd/statvfs.c
               smbd/dmapi.c smbd/signing.c
               smbd/file_access.c
               smbd/dnsregister.c smbd/globals.c
               smbd/smb2_server.c
               smbd/smb2_signing.c
               smbd/smb2_glue.c
               smbd/smb2_negprot.c
               smbd/smb2_sesssetup.c
               smbd/smb2_tcon.c
               smbd/smb2_create.c
               smbd/smb2_close.c
               smbd/smb2_flush.c
               smbd/smb2_read.c
               smbd/smb2_write.c
               smbd/smb2_lock.c
               smbd/smb2_ioctl.c
               smbd/smb2_keepalive.c
               smbd/smb2_find.c
               smbd/smb2_notify.c
               smbd/smb2_getinfo.c
               smbd/smb2_setinfo.c
               smbd/smb2_break.c
               ../libcli/smb/smb2_create_blob.c
               ${MANGLE_SRC}'''

SMBD_SRC_BASE = '''${SMBD_SRC_SRV}
                ${RPC_SERVER_SRC}
                ${PRINTING_SRC}
                ${PRINTBACKEND_SRC}
                ${OPLOCK_SRC} ${NOTIFY_SRC} ${FNAME_UTIL_SRC}
                ${REG_FULL_SRC}
                ${BUILDOPT_SRC}
                ${LIBSMBCONF_SRC}
                ${LIBCLI_SPOOLSS_SRC}
                ${LIBCLI_WINREG_SRC}
                ${LIBCLI_SRVSVC_SRC}
                ${LIBCLI_LSA_SRC}
                ${LIBCLI_SAMR_SRC}
                ${LIBCLI_NETLOGON_SRC}
                ${RPC_CLIENT_SCHANNEL_SRC}
                rpc_client/init_netlogon.c
                rpc_client/init_samr.c
                ${PRIVILEGES_BASIC_SRC}
                ${REGFIO_SRC}
                ${REG_API_REGF_SRC}
                ${LIBNDR_XATTR_SRC}'''

PRINTING_SRC = '''printing/pcap.c printing/print_svid.c printing/print_aix.c
               printing/print_cups.c printing/print_generic.c
               printing/lpq_parse.c printing/load.c printing/print_standard.c
               printing/print_iprint.c printing/printer_list.c'''

PRINTBASE_SRC = '''printing/notify.c printing/printing_db.c'''
PRINTBACKEND_SRC = '''printing/printing.c
                      printing/nt_printing.c
                      printing/nt_printing_tdb.c
                      printing/nt_printing_migrate.c
                      printing/nt_printing_ads.c
                      ${LIBNDR_NTPRINTING_SRC}
                      ${PRINTBASE_SRC}'''

SMBD_SRC = '''${SMBD_SRC_BASE} ${SMBD_SRC_MAIN}'''

NMBD_SRC1 = '''nmbd/asyncdns.c nmbd/nmbd.c nmbd/nmbd_become_dmb.c
            nmbd/nmbd_become_lmb.c nmbd/nmbd_browserdb.c
            nmbd/nmbd_browsesync.c nmbd/nmbd_elections.c
            nmbd/nmbd_incomingdgrams.c nmbd/nmbd_incomingrequests.c
            nmbd/nmbd_lmhosts.c nmbd/nmbd_logonnames.c nmbd/nmbd_mynames.c
            nmbd/nmbd_namelistdb.c nmbd/nmbd_namequery.c
            nmbd/nmbd_nameregister.c nmbd/nmbd_namerelease.c
            nmbd/nmbd_nodestatus.c nmbd/nmbd_packets.c
            nmbd/nmbd_processlogon.c nmbd/nmbd_responserecordsdb.c
            nmbd/nmbd_sendannounce.c nmbd/nmbd_serverlistdb.c
            nmbd/nmbd_subnetdb.c nmbd/nmbd_winsproxy.c nmbd/nmbd_winsserver.c
            nmbd/nmbd_workgroupdb.c nmbd/nmbd_synclists.c'''

NMBD_SRC = '${NMBD_SRC1}'

SWAT_SRC1 = '''web/cgi.c web/diagnose.c web/startstop.c web/statuspage.c
               web/swat.c web/neg_lang.c'''

SWAT_SRC = '''${SWAT_SRC1} ${PRINTING_SRC} ${PRINTBASE_SRC}
           ${PASSCHANGE_SRC} ${FNAME_UTIL_SRC}
           ${LIBCLI_SAMR_SRC}
           rpc_client/init_lsa.c'''

STATUS_SRC = '''utils/status.c utils/status_profile.c
             ${FNAME_UTIL_SRC}'''

SMBCONTROL_SRC = '''utils/smbcontrol.c ${PRINTBASE_SRC}'''

SMBTREE_SRC = '''utils/smbtree.c
             ${LIBCLI_SRVSVC_SRC}'''

TESTPARM_SRC = 'utils/testparm.c'

SMBTA_UTIL_SRC = '''utils/smbta-util.c ${FNAME_UTIL_SRC}'''

TEST_LP_LOAD_SRC = '''param/test_lp_load.c'''

PASSWD_UTIL_SRC = 'utils/passwd_util.c'

SMBPASSWD_SRC = '''utils/smbpasswd.c ${PASSCHANGE_SRC}
                ${LIBCLI_SAMR_SRC}
                rpc_client/init_lsa.c'''

PDBEDIT_SRC = '''utils/pdbedit.c
                ${LIBCLI_LDAP_NDR_SRC}'''

SMBGET_SRC = '''utils/smbget.c'''

DISPLAY_SEC_SRC= '../libcli/security/display_sec.c'

RPCCLIENT_SRC1 = '''rpcclient/rpcclient.c rpcclient/cmd_lsarpc.c
                    rpcclient/cmd_samr.c rpcclient/cmd_spoolss.c
                    rpcclient/cmd_netlogon.c rpcclient/cmd_srvsvc.c
                    rpcclient/cmd_dfs.c rpcclient/cmd_epmapper.c
                    rpcclient/cmd_dssetup.c rpcclient/cmd_echo.c
                    rpcclient/cmd_shutdown.c rpcclient/cmd_test.c
                    rpcclient/cmd_wkssvc.c rpcclient/cmd_ntsvcs.c
                    rpcclient/cmd_drsuapi.c rpcclient/cmd_eventlog.c
                    rpcclient/cmd_winreg.c'''

RPCCLIENT_SRC = '''${RPCCLIENT_SRC1}
                   ${LIBCLI_SPOOLSS_SRC}
                   ${LIBCLI_EVENTLOG_SRC}
                   ${LIBCLI_NTSVCS_SRC}
                   ${LIBCLI_DRSUAPI_SRC}
                   ${LIBCLI_DFS_SRC}
                   ${LIBCLI_ECHO_SRC}
                   ${LIBCLI_DSSETUP_SRC}
                   ${LIBCLI_WKSSVC_SRC}
                   ${LIBCLI_SRVSVC_SRC}
                   ${LIBCLI_LSA_SRC}
                   ${LIBCLI_SAMR_SRC}
                   ${LIBCLI_WINREG_SRC}
                   ${LIBCLI_NETLOGON_SRC}
                   ${RPC_CLIENT_SCHANNEL_SRC}
                   rpc_client/init_netlogon.c
                   rpc_client/init_samr.c'''

PAM_WINBIND_SRC = '../nsswitch/pam_winbind.c ${WBCOMMON_SRC} ${LIBREPLACE_SRC}'

LIBSMBCLIENT_THREAD_SRC = '''libsmb/libsmb_thread_impl.c
                        libsmb/libsmb_thread_posix.c'''

LIBSMBCLIENT_SRC0 = '''libsmb/libsmb_cache.c
                    libsmb/libsmb_compat.c
                    libsmb/libsmb_context.c
                    libsmb/libsmb_dir.c
                    libsmb/libsmb_file.c
                    libsmb/libsmb_misc.c
                    libsmb/libsmb_path.c
                    libsmb/libsmb_printjob.c
                    libsmb/libsmb_server.c
                    libsmb/libsmb_stat.c
                    libsmb/libsmb_xattr.c
                    libsmb/libsmb_setget.c'''

LIBSMBCLIENT_SRC1 = '''${LIBSMBCLIENT_SRC0}
                    ${LIBCLI_SRVSVC_SRC}
                    ${LIBCLI_LSA_SRC}'''

LIBSMBCLIENT_SRC = '${LIBSMBCLIENT_SRC1}'

LIBSMBSHAREMODES_SRC0 = 'libsmb/smb_share_modes.c'

LIBSMBSHAREMODES_SRC = '${LIBSMBSHAREMODES_SRC0}'

LIBNETAPI_SRC0 = '''lib/netapi/netapi.c
                    lib/netapi/cm.c
                    librpc/gen_ndr/ndr_libnetapi.c
                    lib/netapi/libnetapi.c
                    lib/netapi/joindomain.c
                    lib/netapi/serverinfo.c
                    lib/netapi/getdc.c
                    lib/netapi/user.c
                    lib/netapi/group.c
                    lib/netapi/localgroup.c
                    lib/netapi/samr.c
                    lib/netapi/sid.c
                    lib/netapi/share.c
                    lib/netapi/file.c
                    lib/netapi/shutdown.c
                    lib/netapi/netlogon.c'''

LIBNETAPI_SRC = '''${LIBNETAPI_SRC0}
                   ${LIBSMBCONF_SRC}
                   ${REG_SMBCONF_SRC}
                   ${PRIVILEGES_BASIC_SRC}
                   auth/token_util.c
                   ${LIBCLI_INITSHUTDOWN_SRC}
                   ${LIBCLI_WKSSVC_SRC}
                   ${LIBCLI_SRVSVC_SRC}
                   ${LIBCLI_LSA_SRC}
                   ${LIBCLI_SAMR_SRC}
                   ${LIBCLI_NETLOGON_SRC}
                   ${RPC_CLIENT_SCHANNEL_SRC}
                   rpc_client/init_netlogon.c
                   rpc_client/init_samr.c'''

# FIXME:  bigballofmud

CLIENT_SRC1 = '''client/client.c client/clitar.c
                 client/dnsbrowse.c'''

CLIENT_SRC = '''${CLIENT_SRC1}
                ${LIBCLI_SRVSVC_SRC}
                rpc_client/init_lsa.c'''

LIBSMBCONF_SRC = '''../lib/smbconf/smbconf.c ../lib/smbconf/smbconf_util.c
                    ../lib/smbconf/smbconf_txt.c lib/smbconf/smbconf_reg.c
                    lib/smbconf/smbconf_init.c'''

SMBCONFTORT_SRC0 = 'lib/smbconf/testsuite.c'

SMBCONFTORT_SRC = '''${SMBCONFTORT_SRC0}'''

LIBNET_SRC = 'libnet/libnet_join.c libnet/libnet_keytab.c'


LIBNET_DSSYNC_SRC = '''libnet/libnet_dssync.c
                       libnet/libnet_dssync_keytab.c
                       ../libcli/drsuapi/repl_decrypt.c'''

LIBNET_SAMSYNC_SRC = '''libnet/libnet_samsync.c
                        libnet/libnet_samsync_ldif.c
                        libnet/libnet_samsync_passdb.c
                        libnet/libnet_samsync_display.c
                        libnet/libnet_samsync_keytab.c
                        ../libcli/samsync/decrypt.c'''

NET_SRC1 = '''utils/net.c utils/net_ads.c utils/net_help.c
              utils/net_rap.c utils/net_rpc.c utils/net_rpc_samsync.c
              utils/net_rpc_join.c utils/net_time.c utils/net_lookup.c
              utils/net_cache.c utils/net_groupmap.c utils/net_idmap.c
              utils/net_status.c utils/net_rpc_printer.c utils/net_rpc_rights.c
              utils/net_rpc_service.c utils/net_rpc_registry.c utils/net_usershare.c
              utils/netlookup.c utils/net_sam.c utils/net_rpc_shell.c
              utils/net_util.c utils/net_rpc_sh_acct.c utils/net_rpc_audit.c
              utils/net_dns.c utils/net_ads_gpo.c
              utils/net_conf.c utils/net_join.c utils/net_user.c
              utils/net_group.c utils/net_file.c utils/net_registry.c
              auth/token_util.c utils/net_dom.c utils/net_share.c
              utils/net_g_lock.c
              utils/net_serverid.c
              utils/net_eventlog.c
              utils/net_printing.c
              ${LIBNDR_NTPRINTING_SRC}
              ${LIBNDR_PREG_SRC}
              ${LIBCLI_SPOOLSS_SRC}
              ${LIBCLI_WINREG_SRC}
              ${LIBCLI_DRSUAPI_SRC}
              ${LIBCLI_INITSHUTDOWN_SRC}
              ${LIBCLI_DSSETUP_SRC}
              ${LIBCLI_SVCCTL_SRC}
              ${LIBCLI_WKSSVC_SRC}
              ${LIBCLI_SRVSVC_SRC}
              ${LIBCLI_LSA_SRC}
              ${LIBCLI_SAMR_SRC}
              ${LIBCLI_NETLOGON_SRC}
              ${RPC_CLIENT_SCHANNEL_SRC}
              rpc_client/init_netlogon.c
              rpc_client/init_samr.c
              registry/reg_parse.c registry/reg_format.c
              registry/reg_parse_internal.c registry/reg_import.c
              lib/cbuf.c lib/srprs.c'''

NET_SRC2 = 'utils/net_registry_util.c utils/net_help_common.c'

NET_SRC = '''${NET_SRC1}
             ${NET_SRC2}
             ${REGFIO_SRC}'''

CUPS_SRC = '''client/smbspool.c'''

NMBLOOKUP_SRC = '''utils/nmblookup.c ${LIBNMB_SRC}'''

SMBTORTURE_SRC1 = '''torture/torture.c torture/nbio.c torture/scanner.c torture/utable.c
                torture/denytest.c torture/mangle_test.c
                torture/nbench.c
                torture/test_posix_append.c'''

SMBTORTURE_SRC = '''${SMBTORTURE_SRC1} ${TLDAP_SRC}
        ../nsswitch/libwbclient/wbc_async.c
        ../nsswitch/libwbclient/wb_reqtrans.c'''

MASKTEST_SRC = '''torture/masktest.c'''

MSGTEST_SRC = '''torture/msgtest.c'''

LOCKTEST_SRC = '''torture/locktest.c ${FNAME_UTIL_SRC}'''

NSSTEST_SRC = '''torture/nsstest.c ${LIBSAMBAUTIL_SRC}'''

PDBTEST_SRC = '''torture/pdbtest.c'''

VFSTEST_SRC = '''torture/cmd_vfs.c torture/vfstest.c'''

SMBICONV_SRC = '''torture/smbiconv.c'''

LOG2PCAP_SRC = '''utils/log2pcaphex.c'''

LOCKTEST2_SRC = '''torture/locktest2.c ${FNAME_UTIL_SRC}'''

SMBCACLS_SRC = '''utils/smbcacls.c
                ${LIBCLI_LSA_SRC}'''

SMBCQUOTAS_SRC = '''utils/smbcquotas.c
                ${LIBCLI_LSA_SRC}'''

EVTLOGADM_SRC0 = 'utils/eventlogadm.c'

EVTLOGADM_SRC = '''${EVTLOGADM_SRC0}
                registry/reg_eventlog.c'''

SHARESEC_SRC0 = 'utils/sharesec.c'
SHARESEC_SRC  = '''${SHARESEC_SRC0}'''

DEBUG2HTML_SRC = '''utils/debug2html.c utils/debugparse.c'''

SMBFILTER_SRC = '''utils/smbfilter.c'''

WINBIND_WINS_NSS_SRC = '''../nsswitch/wins.c ${PARAM_SRC}
        ${LIB_NONSMBD_SRC} ${LIBSMB_ERR_SRC} ${LIBNMB_SRC}'''

PAM_SMBPASS_SRC_0 = '''pam_smbpass/pam_smb_auth.c pam_smbpass/pam_smb_passwd.c
                pam_smbpass/pam_smb_acct.c pam_smbpass/support.c ../lib/util/asn1.c'''
PAM_SMBPASS_SRC = '''${PAM_SMBPASS_SRC_0} ${PARAM_SRC} ${LIB_NONSMBD_SRC} ${PASSDB_SRC} ${GROUPDB_SRC} \
                ${SMBLDAP_SRC} ${LIBSAMBA_SRC} \
                ${LIBTSOCKET_SRC}'''

WBINFO_SRC = '''../nsswitch/wbinfo.c'''

WINBIND_NSS_SRC = '''${WBCOMMON_SRC} ${LIBREPLACE_SRC}'''

WINBIND_KRB5_LOCATOR_SRC1 = '../nsswitch/winbind_krb5_locator.c'
WINBIND_KRB5_LOCATOR_SRC = '''${WINBIND_KRB5_LOCATOR_SRC1} ${LIBREPLACE_SRC}'''

POPT_SRC = '''../lib/popt/findme.c ../lib/popt/popt.c ../lib/popt/poptconfig.c \
          ../lib/popt/popthelp.c ../lib/popt/poptparse.c'''

NTLM_AUTH_SRC1 = '''utils/ntlm_auth.c utils/ntlm_auth_diagnostics.c'''

NTLM_AUTH_SRC = '''${NTLM_AUTH_SRC1}
                ../libcli/auth/spnego_parse.c libsmb/clikrb5.c libads/kerberos.c
                libsmb/samlogon_cache.c
                ${LIBNMB_SRC}
                ${LIBCLI_LDAP_NDR_SRC}
                ${LIBNDR_NETLOGON_SRC}'''


VLP_SRC = '''printing/tests/vlp.c
          ../lib/util/util_tdb.c
          ${LIBSAMBAUTIL_SRC}
          param/util.c'''

RPC_OPEN_TCP_SRC = 'torture/rpc_open_tcp.c'

DBWRAP_TOOL_SRC = 'utils/dbwrap_tool.c'

DBWRAP_TORTURE_SRC = 'utils/dbwrap_torture.c'

SPLIT_TOKENS_SRC = 'utils/split_tokens.c'

LIBS='ICONV'

bld.SAMBA_GENERATOR('build_options',
                    source='include/config.h script/mkbuildoptions.awk',
                    target='smbd/build_options.c',
                    rule='${AWK} -f ${SRC[1].abspath(env)} > ${TGT} < ${SRC[0].abspath(env)}')

t = bld.SAMBA_GENERATOR('build_env.h',
                        source='script/build_env.sh',
                        target='include/build_env.h',
                        rule='${SRC} ${SRCDIR} ${BUILDDIR} ${CC} > ${TGT}')
# todo: work out what is really wanted here
t.env.SRCDIR = bld.path.abspath()
t.env.BUILDDIR = bld.path.abspath()


bld.SETUP_BUILD_GROUPS()

bld.RECURSE('../lib/replace')
print "SBINDIR=%s" % bld.env.SBINDIR
bld.RECURSE('build')

bld.RECURSE('../librpc')
bld.RECURSE('librpc/idl')
bld.RECURSE('librpc')

bld.SAMBA_MKVERSION('include/version.h')

for prefix in bld.env.MODULE_PREFIXES:

    if prefix == 'auth': continue
    if prefix == 'pdb': continue
    if prefix == 'idmap': continue
    if prefix == 'charset': continue
    if prefix == 'perfcount': continue
    if prefix == 'gpext': continue
    if prefix == 'vfs': continue

    static_key = "%s_STATIC" % prefix.upper()
    shared_key = "%s_SHARED" % prefix.upper()

    for module in bld.env[static_key]:
        bld.SAMBA_SUBSYSTEM(module,
                            source="${%s_SRC}" % module,
                            vars=locals())

    # Set up subsystems for the shared modules
    for module in bld.env[shared_key]:
        bld.SAMBA_MODULE(module,
                            source="${%s_SRC}" % module,
                            vars=locals())

######################## SUBSYSTEMS #################################

bld.SAMBA_SUBSYSTEM('WBCOMMON',
                    source=WBCOMMON_SRC)

bld.SAMBA_LIBRARY('libwbclient',
                    source='''../nsswitch/libwbclient/wbc_guid.c
                              ../nsswitch/libwbclient/wbc_idmap.c
                              ../nsswitch/libwbclient/wbclient.c
                              ../nsswitch/libwbclient/wbc_pam.c
                              ../nsswitch/libwbclient/wbc_pwd.c
                              ../nsswitch/libwbclient/wbc_sid.c
                              ../nsswitch/libwbclient/wbc_util.c''',
                    public_headers='../nsswitch/libwbclient/wbclient.h',
                    public_deps='talloc WBCOMMON')

bld.SAMBA_LIBRARY('libnetapi',
                    source=LIBNETAPI_SRC,
                    public_deps='''talloc tdb cap libwbclient LIB_NONSMBD LIBSMB KRBCLIENT
                    PASSDB SMBLDAP GROUPDB PARAM_WITHOUT_REG DYNCONFIG
                    LIBMSRPC_GEN LIBMSRPC LIBADS LIBNET DCUTIL''',
                    public_headers='lib/netapi/netapi.h',
                    vars=locals())

bld.SAMBA_LIBRARY('libsmbclient',
                    source=LIBSMBCLIENT_SRC,
                    public_deps='''talloc tdb libwbclient cap PARAM LIB_NONSMBD LIBSMB KRBCLIENT PASSDB SMBLDAP GROUPDB
                    LIBMSRPC_GEN LIBMSRPC''',
                    public_headers='include/libsmbclient.h',
                    vars=locals())

bld.SAMBA_LIBRARY('libsmbsharemodes',
                    source=LIBSMBSHAREMODES_SRC,
                    public_deps='''talloc tdb''',
                    public_headers='include/smb_share_modes.h',
                    vars=locals())

bld.SAMBA_LIBRARY('libaddns',
                    source=LIBADDNS_SRC,
                    deps='SOCKET_WRAPPER',
                    public_deps='talloc krb5 k5crypto com_err gssapi gssapi_krb5',
                    vars=locals())

bld.SAMBA_SUBSYSTEM('LIBMSRPC',
                    source='${LIBMSRPC_SRC}',
                    deps='LIBNDR NDR_SECURITY NDR_DCERPC',
                    vars=locals())

bld.SAMBA_SUBSYSTEM('LIBMSRPC_GEN',
                    source='${LIBNDR_GEN_SRC}',
                    deps='LIBNDR NDR_SECURITY NDR_DCERPC NDR_EVENTLOG NDR_LSA',
                    vars=locals())

bld.SAMBA_SUBSYSTEM('LIBGPO',
                    source='${LIBGPO_SRC}',
                    vars=locals())

bld.SAMBA_SUBSYSTEM('ASN1_UTIL',
                    source='../lib/util/asn1.c',
                    deps='talloc',
                    local_include=False)

bld.SAMBA_SUBSYSTEM('IDMAP',
                    source=IDMAP_SRC,
                    deps='''IDMAP_AD IDMAP_RID IDMAP_PASSDB IDMAP_LDAP IDMAP_TDB2 IDMAP_HASH IDMAP_ADEX''',
                    vars=locals())

bld.SAMBA_MODULE('IDMAP_AD',
                 subsystem='IDMAP',
                 source=IDMAP_AD_SRC,
                 init_function='',
                 internal_module=True,
                 enabled=True)

bld.SAMBA_MODULE('IDMAP_RID',
                 subsystem='IDMAP',
                 source=IDMAP_RID_SRC,
                 init_function='',
                 internal_module=True,
                 enabled=True)

bld.SAMBA_MODULE('IDMAP_PASSDB',
                 subsystem='IDMAP',
                 source=IDMAP_PASSDB_SRC,
                 init_function='',
                 internal_module=True,
                 enabled=True)

bld.SAMBA_MODULE('IDMAP_LDAP',
                 subsystem='IDMAP',
                 source=IDMAP_LDAP_SRC,
                 init_function='',
                 internal_module=True,
                 enabled=True)

bld.SAMBA_MODULE('IDMAP_TDB2',
                 subsystem='IDMAP',
                 source=IDMAP_TDB2_SRC,
                 init_function='',
                 internal_module=True,
                 enabled=True)

bld.SAMBA_MODULE('IDMAP_HASH',
                 subsystem='IDMAP',
                 source=IDMAP_HASH_SRC,
                 init_function='',
                 internal_module=True,
                 enabled=True)

bld.SAMBA_MODULE('IDMAP_ADEX',
                 subsystem='IDMAP',
                 source=IDMAP_ADEX_SRC,
                 init_function='',
                 internal_module=True,
                 enabled=True)

bld.SAMBA_SUBSYSTEM('CHARSET',
                    source='',
                    deps='''CHARSET_WEIRD CHARSET_CP850 CHARSET_CP437 CHARSET_MACOSXFS''',
                    vars=locals())

bld.SAMBA_MODULE('CHARSET_WEIRD',
                 subsystem='CHARSET',
                 source=CHARSET_WEIRD_SRC,
                 init_function='',
                 internal_module=True,
                 enabled=True)

bld.SAMBA_MODULE('CHARSET_CP850',
                 subsystem='CHARSET',
                 source=CHARSET_CP850_SRC,
                 init_function='',
                 internal_module=True,
                 enabled=True)

bld.SAMBA_MODULE('CHARSET_CP437',
                 subsystem='CHARSET',
                 source=CHARSET_CP437_SRC,
                 init_function='',
                 internal_module=True,
                 enabled=True)

bld.SAMBA_MODULE('CHARSET_MACOSXFS',
                 subsystem='CHARSET',
                 source=CHARSET_MACOSXFS_SRC,
                 init_function='',
                 internal_module=True,
                 enabled=False) #fixme

bld.SAMBA_SUBSYSTEM('PERFCOUNT',
                    source='',
                    deps='''PERFCOUNT_ONEFS PERFCOUNT_TEST''',
                    vars=locals())

bld.SAMBA_MODULE('PERFCOUNT_ONEFS',
                 subsystem='PERFCOUNT',
                 source=PERFCOUNT_ONEFS_SRC,
                 init_function='',
                 internal_module=True,
                 enabled=False) #fixme

bld.SAMBA_MODULE('PERFCOUNT_TEST',
                 subsystem='PERFCOUNT',
                 source=PERFCOUNT_TEST_SRC,
                 init_function='',
                 internal_module=True,
                 enabled=True)

bld.SAMBA_SUBSYSTEM('GPEXT',
                    source=GPEXT_SRC,
                    deps='''GPEXT_REGISTRY GPEXT_SCRIPTS GPEXT_SECURITY''',
                    vars=locals())

bld.SAMBA_MODULE('GPEXT_REGISTRY',
                 subsystem='GPEXT',
                 source=GPEXT_REGISTRY_SRC,
                 init_function='',
                 internal_module=True,
                 enabled=True)

bld.SAMBA_MODULE('GPEXT_SCRIPTS',
                 subsystem='GPEXT',
                 source=GPEXT_SCRIPTS_SRC,
                 init_function='',
                 internal_module=True,
                 enabled=True)

bld.SAMBA_MODULE('GPEXT_SECURITY',
                 subsystem='GPEXT',
                 source=GPEXT_SECURITY_SRC,
                 init_function='',
                 internal_module=True,
                 enabled=True)

bld.SAMBA_SUBSYSTEM('AVAHI',
                    source=AVAHI_SRC,
                    deps='avahi-common avahi-client',
                    enabled=bld.env.with_avahi)

bld.SAMBA_SUBSYSTEM('GROUPDB',
                    source=GROUPDB_SRC)

bld.SAMBA_SUBSYSTEM('TLDAP',
                    source=TLDAP_SRC,
                    deps='ASN1_UTIL LIBTSOCKET')

bld.SAMBA_SUBSYSTEM('PASSDB',
                    source=PASSDB_SRC,
                    deps='''GROUPDB TLDAP SECRETS SMBLDAP PDB''',
                    vars=locals())

bld.SAMBA_SUBSYSTEM('PARAM_WITHOUT_REG',
                    source=PARAM_WITHOUT_REG_SRC)

bld.SAMBA_SUBSYSTEM('PARAM',
                    source=PARAM_SRC,
                    deps='PARAM_WITHOUT_REG DYNCONFIG',
                    vars=locals())

bld.SAMBA_SUBSYSTEM('POPT_SAMBA',
                    source=POPT_LIB_SRC,
                    vars=locals())

bld.SAMBA_SUBSYSTEM('KRBCLIENT',
                    source=KRBCLIENT_SRC,
                    deps='krb5 k5crypto com_err gssapi gssapi_krb5',
                    vars=locals())

bld.SAMBA_SUBSYSTEM('LIBS',
                    source=LIB_SRC,
                    deps='NSS_WRAPPER iconv LIBCRYPTO LIBNDR NDR_SECURITY',
                    vars=locals())

bld.SAMBA_SUBSYSTEM('LIB_NONSMBD',
                    source=LIB_NONSMBD_SRC,
                    deps='LIBS',
                    vars=locals())

bld.SAMBA_SUBSYSTEM('LIBSMB_ERR',
                    source=LIBSMB_ERR_SRC,
                    deps='SECRETS ldap lber',
                    vars=locals())

bld.SAMBA_SUBSYSTEM('LIBSAMBA',
                    source=LIBSAMBA_SRC,
                    deps='LIBSMB_ERR',
                    vars=locals())

bld.SAMBA_SUBSYSTEM('LIBSMB',
                    source=LIBSMB_SRC,
                    deps='LIBSAMBA ZLIB',
                    vars=locals())

bld.SAMBA_SUBSYSTEM('SECRETS',
                    source=SECRETS_SRC,
                    vars=locals())

bld.SAMBA_SUBSYSTEM('SMBLDAP',
                    source=SMBLDAP_SRC,
                    deps='ldap lber',
                    vars=locals())

bld.SAMBA_SUBSYSTEM('LIBADS',
                    source=LIBADS_SRC,
		    vars=locals())

bld.SAMBA_SUBSYSTEM('LIBADS_SERVER',
                    source=LIBADS_SERVER_SRC,
		    vars=locals())

bld.SAMBA_SUBSYSTEM('LIBADS_PRINTER',
                    source=LIBADS_PRINTER_SRC,
		    vars=locals())

bld.SAMBA_SUBSYSTEM('LIBAFS',
                    source=AFS_SRC,
                    vars=locals())

bld.SAMBA_SUBSYSTEM('LIBAFS_SETTOKEN',
                    source=AFS_SETTOKEN_SRC,
                    vars=locals())

bld.SAMBA_SUBSYSTEM('SMBD_BASE',
                    source=SMBD_SRC_BASE,
                    deps='''tdb tevent dl krb5 ldap gssapi gssapi_krb5
                    NSS_WRAPPER DYNCONFIG libwbclient crypt nsl cups cap resolv ZLIB PASSDB
                    PARAM_WITHOUT_REG LIBS LIBSMB POPT_SAMBA KRBCLIENT AVAHI
                    LIBMSRPC_GEN LIBMSRPC LIBADS LIBADS_SERVER LIBADS_PRINTER
                    VFS RPC_MODULES AUTH LOCKING LIBAFS LIBAFS_SETTOKEN PROFILE LIBNET LIBEVENTLOG''',
                    vars=locals())

bld.SAMBA_SUBSYSTEM('RPC_MODULES',
                    source='',
                    deps='''RPC_LSARPC RPC_SAMR RPC_WINREG RPC_INITSHUTDOWN
                            RPC_DSSETUP RPC_WKSSVC RPC_SVCCTL RPC_NTSVCS
                            RPC_NETLOGON RPC_NETDFS RPC_SRVSVC RPC_SPOOLSS
                            RPC_EVENTLOG RPC_RPCECHO''')

bld.SAMBA_SUBSYSTEM('LOCKING',
                    source='${LOCKING_SRC}',
                    deps='''tdb talloc''',
                    vars=locals())

bld.SAMBA_SUBSYSTEM('PROFILE',
                    source='${PROFILE_SRC}',
                    vars=locals())

bld.SAMBA_SUBSYSTEM('READLINE',
                    source=READLINE_SRC,
                    vars=locals())

bld.SAMBA_SUBSYSTEM('PASSWD_UTIL',
                    source=PASSWD_UTIL_SRC,
                    vars=locals())

bld.SAMBA_SUBSYSTEM('DISPLAY_SEC',
                    source=DISPLAY_SEC_SRC,
                    vars=locals())

bld.SAMBA_SUBSYSTEM('LIBNET',
                    source=LIBNET_SRC,
                    deps='NDR_LIBNET_JOIN',
                    vars=locals())

bld.SAMBA_SUBSYSTEM('LIBNET_DSSYNC',
                    source=LIBNET_DSSYNC_SRC,
                    deps='LIBNET',
                    vars=locals())

bld.SAMBA_SUBSYSTEM('LIBNET_SAMSYNC',
                    source=LIBNET_SAMSYNC_SRC,
                    deps='LIBNET',
                    vars=locals())

bld.SAMBA_SUBSYSTEM('LIBEVENTLOG',
                    source=LIB_EVENTLOG_SRC,
                    deps='NDR_EVENTLOG',
                    vars=locals())

bld.SAMBA_SUBSYSTEM('PLAINTEXT_AUTH',
                    source=PLAINTEXT_AUTH_SRC,
                    vars=locals())

bld.SAMBA_SUBSYSTEM('SLCACHE',
                    source=SLCACHE_SRC,
                    vars=locals())

bld.SAMBA_SUBSYSTEM('DCUTIL',
                    source=DCUTIL_SRC,
                    vars=locals())

bld.SAMBA_SUBSYSTEM('LIBNDR',
                    source=LIBNDR_SRC,
                    vars=locals())

#FIXME
bld.SAMBA_SUBSYSTEM('NDR_STANDARD',
                    source=LIBNDR_SRC,
                    vars=locals())

#FIXME
bld.SAMBA_SUBSYSTEM('dcerpc', '')

bld.SAMBA_SUBSYSTEM('LZXPRESS',
		    deps='replace',
		    source='../lib/compression/lzxpress.c')

bld.SAMBA_SUBSYSTEM('NDR_SECURITY',
                    source='''../librpc/gen_ndr/ndr_security.c ../librpc/ndr/ndr_sec_helper.c''',
                    deps='LIBNDR',
                    vars=locals())

bld.SAMBA_SUBSYSTEM('NDR_DCERPC',
                    source='../librpc/gen_ndr/ndr_dcerpc.c',
                    vars=locals())

bld.SAMBA_SUBSYSTEM('NDR_SRVSVC',
                    source='../librpc/gen_ndr/ndr_srvsvc.c',
                    vars=locals())

bld.SAMBA_SUBSYSTEM('LIBSAMBA-ERRORS',
		    source='../libcli/util/doserr.c libsmb/nterr.c')

bld.SAMBA_SUBSYSTEM('NDR_NBT_BUF',
		    source='../libcli/nbt/nbtname.c',
		    deps='talloc',
		    autoproto='nbtname.h')

bld.SAMBA_SUBSYSTEM('LIBCLI_NDR_NETLOGON',
		    source='../libcli/ndr_netlogon.c',
		    public_deps='LIBNDR NDR_SECURITY')

########################## BINARIES #################################

bld.SAMBA_BINARY('smbd/smbd',
                 source='${SMBD_SRC_MAIN}',
                 deps='''SMBD_BASE''',
                 install_path='${SBINDIR}',
                 vars=locals())

bld.SAMBA_BINARY('nmbd/nmbd',
                 source=NMBD_SRC,
                 deps='''talloc tdb tevent ZLIB cap resolv libwbclient dl
                 NSS_WRAPPER PASSDB PARAM ldap LIB_NONSMBD LIBSMB
                 POPT_SAMBA KRBCLIENT NDR_SAMR NDR_LSA''',
                 install_path='${SBINDIR}',
                 vars=locals())

bld.SAMBA_BINARY('winbindd/winbindd',
                 source=WINBINDD_SRC,
                 deps='''talloc tdb tevent cap dl ZLIB NSS_WRAPPER
                 libwbclient PASSDB ldap resolv PARAM LIB_NONSMBD LIBSMB
                 POPT_SAMBA KRBCLIENT LIBMSRPC_GEN LIBMSRPC LIBADS LIBADS_SERVER
                 NSS_INFO_TEMPLATE SRV_NDR_WBINT RPCCLI_NDR_WBINT LIBAFS
                 LIBAFS_SETTOKEN PROFILE SLCACHE DCUTIL
                 ''',
                 enabled=bld.env.build_winbind,
                 install_path='${SBINDIR}',
                 vars=locals())

bld.SAMBA_BINARY('web/swat',
                 source=SWAT_SRC,
                 deps='''talloc tevent cap LIBS LIBSMB libwbclient PARAM
                 LIB_NONSMBD resolv PASSDB POPT_SAMBA KRBCLIENT cups
                 LIBMSRPC_GEN LIBMSRPC LOCKING PLAINTEXT_AUTH''',
                 enabled=bld.env.build_swat,
                 install_path='${SBINDIR}',
                 vars=locals())

bld.SAMBA_BINARY('rpcclient/rpcclient',
                 source=RPCCLIENT_SRC,
                 deps='''talloc tdb cap resolv POPT_SAMBA PASSDB LIBSMB LIB_NONSMBD
                 PARAM_WITHOUT_REG libwbclient PARAM KRBCLIENT LIBMSRPC_GEN LIBMSRPC
                 LIBADS READLINE DISPLAY_SEC DCUTIL''',
                 vars=locals())

bld.SAMBA_BINARY('smbclient',
                 source=CLIENT_SRC,
                 deps='''talloc tdb cap resolv POPT_SAMBA PASSDB LIBSMB LIB_NONSMBD
                 PARAM_WITHOUT_REG libwbclient PARAM KRBCLIENT LIBMSRPC_GEN
                 LIBMSRPC READLINE DISPLAY_SEC''',
                 vars=locals())

bld.SAMBA_BINARY('net',
                 source=NET_SRC,
                 deps='''talloc tdb libnetapi libaddns cap resolv POPT_SAMBA PASSDB LIBSMB LIB_NONSMBD
                 PARAM_WITHOUT_REG libwbclient PARAM KRBCLIENT LIBMSRPC_GEN LIBMSRPC LIBGPO LIBADS LIBADS_SERVER LIBADS_PRINTER
                 LOCALE_DIR LIBAFS LIBAFS_SETTOKEN READLINE PASSWD_UTIL LIBNET
                 LIBNET_DSSYNC LIBNET_SAMSYNC LIBEVENTLOG DISPLAY_SEC DCUTIL''',
                 vars=locals())

bld.SAMBA_BINARY('profiles',
                 source=PROFILES_SRC,
                 deps='''talloc tdb cap tevent POPT_SAMBA PARAM LIBS LIBSMB_ERR LIB_NONSMBD''',
                 vars=locals())

bld.SAMBA_BINARY('smbspool',
                 source=CUPS_SRC,
                 deps='''talloc tdb tevent resolv cap libwbclient POPT_SAMBA PARAM LIBSMB LIB_NONSMBD LIBS
                 KRBCLIENT ASN1_UTIL LIBTSOCKET NDR_SAMR NDR_LSA''',
                 vars=locals())

bld.SAMBA_BINARY('testparm',
                 source=TESTPARM_SRC,
                 deps='''talloc tevent ldap cap NSS_WRAPPER
                 libwbclient ASN1_UTIL LIBTSOCKET PASSDB PARAM LIB_NONSMBD
                 LIBSMB_ERR POPT_SAMBA''',
                 vars=locals())

bld.SAMBA_BINARY('smbta-util',
                 source=SMBTA_UTIL_SRC,
                 deps='''talloc tdb tevent cap PARAM POPT_SAMBA LIB_NONSMBD
                 LIBSMB_ERR''',
                 vars=locals())

bld.SAMBA_BINARY('smbstatus',
                 source=STATUS_SRC,
                 deps='''talloc tdb tevent cap PARAM POPT_SAMBA LIB_NONSMBD
                 LIBSMB_ERR LOCKING PROFILE''',
                 vars=locals())

bld.SAMBA_BINARY('smbcontrol',
                 source=SMBCONTROL_SRC,
                 deps='''talloc tdb tevent cap PARAM LIB_NONSMBD LIBSMB_ERR POPT_SAMBA''',
                 vars=locals())

bld.SAMBA_BINARY('smbtree',
                 source=SMBTREE_SRC,
                 deps='''talloc tdb tevent cap resolv libwbclient PARAM LIB_NONSMBD
                 LIBSMB LIBSMB_ERR POPT_SAMBA KRBCLIENT PASSDB SMBLDAP GROUPDB LIBMSRPC_GEN LIBMSRPC PROFILE''',
                 vars=locals())

bld.SAMBA_BINARY('smbpasswd',
                 source=SMBPASSWD_SRC,
                 deps='''talloc tdb tevent cap resolv libwbclient PARAM LIB_NONSMBD
                 LIBSMB LIBSMB_ERR POPT_SAMBA KRBCLIENT PASSDB SMBLDAP GROUPDB LIBMSRPC_GEN LIBMSRPC PASSWD_UTIL''',
                 vars=locals())

bld.SAMBA_BINARY('pdbedit',
                 source=PDBEDIT_SRC,
                 deps='''talloc tdb tevent cap resolv libwbclient PARAM LIB_NONSMBD
                 LIBSAMBA LIBSMB_ERR POPT_SAMBA PASSDB SMBLDAP GROUPDB
                 PASSWD_UTIL''',
                 vars=locals())

bld.SAMBA_BINARY('smbget',
                 source=SMBGET_SRC,
                 deps='''talloc tdb libsmbclient POPT_SAMBA''',
                 vars=locals())

bld.SAMBA_BINARY('nmblookup',
                 source=NMBLOOKUP_SRC,
                 deps='''talloc tdb tevent cap resolv PARAM LIB_NONSMBD POPT_SAMBA LIBSMB_ERR''',
                 vars=locals())

bld.SAMBA_BINARY('smbtorture',
                 source=SMBTORTURE_SRC,
                 deps='''talloc tdb tevent cap resolv libwbclient PARAM LIBSMB KRBCLIENT
                 LIB_NONSMBD POPT_SAMBA ASN1_UTIL LIBTSOCKET NDR_SAMR NDR_LSA''',
                 vars=locals())

bld.SAMBA_BINARY('smbconftort',
                 source=SMBCONFTORT_SRC,
                 deps='''talloc tdb tevent cap resolv libwbclient PARAM LIB_NONSMBD LIBSMB_ERR POPT_SAMBA''',
                 vars=locals())

bld.SAMBA_BINARY('masktest',
                 source=MASKTEST_SRC,
                 deps='''talloc tdb cap resolv libwbclient PARAM LIB_NONSMBD LIBSMB KRBCLIENT
                 ASN1_UTIL LIBTSOCKET NDR_SAMR NDR_LSA''',
                 vars=locals())

bld.SAMBA_BINARY('msgtest',
                 source=MSGTEST_SRC,
                 deps='''talloc tdb tevent cap resolv PARAM LIBSMB_ERR LIB_NONSMBD''',
                 vars=locals())

bld.SAMBA_BINARY('smbcacls',
                 source=SMBCACLS_SRC,
                 deps='''talloc tdb cap resolv libwbclient PARAM LIBSMB KRBCLIENT
                 LIB_NONSMBD PASSDB GROUPDB POPT_SAMBA SMBLDAP LIBMSRPC_GEN
                 LIBMSRPC''',
                 vars=locals())

bld.SAMBA_BINARY('smbcquotas',
                 source=SMBCQUOTAS_SRC,
                 deps='''talloc tdb cap resolv libwbclient PARAM LIB_NONSMBD LIBSMB KRBCLIENT
                 POPT_SAMBA PASSDB SMBLDAP GROUPDB LIBMSRPC_GEN LIBMSRPC''',
                 vars=locals())

bld.SAMBA_BINARY('eventlogadm',
                 source=EVTLOGADM_SRC,
                 deps='''talloc tevent cap POPT_SAMBA LIBS PARAM
                 LIB_NONSMBD LIBSMB_ERR PASSDB libwbclient LIBEVENTLOG''',
                 vars=locals())

bld.SAMBA_BINARY('sharesec',
                 source=SHARESEC_SRC,
                 deps='''talloc tdb tevent cap resolv libwbclient PARAM LIB_NONSMBD LIBSMB_ERR POPT_SAMBA''',
                 vars=locals())

bld.SAMBA_BINARY('locktest',
                 source=LOCKTEST_SRC,
                 deps='''talloc tdb tevent cap resolv libwbclient PARAM KRBCLIENT LIBSMB LIB_NONSMBD
                 ASN1_UTIL LIBTSOCKET NDR_SAMR NDR_LSA LOCKING''',
                 vars=locals())

bld.SAMBA_BINARY('nsstest',
                 source=NSSTEST_SRC,
                 deps='NSS_WRAPPER',
                 vars=locals())

bld.SAMBA_BINARY('pdbtest',
                 source=PDBTEST_SRC,
                 deps='''talloc tdb cap resolv libwbclient PARAM LIBSMB KRBCLIENT LIB_NONSMBD PASSDB GROUPDB
                 SMBLDAP POPT_SAMBA NDR_SAMR NDR_LSA''',
                 vars=locals())

bld.SAMBA_BINARY('vfstest',
                 source=VFSTEST_SRC,
                 deps='''SMBD_BASE READLINE''',
                 vars=locals())

bld.SAMBA_BINARY('smbiconv',
                 source=SMBICONV_SRC,
                 deps='''talloc tdb tevent cap PARAM LIB_NONSMBD POPT_SAMBA LIBSMB_ERR''',
                 vars=locals())

bld.SAMBA_BINARY('log2pcap',
                 source=LOG2PCAP_SRC,
                 deps='''talloc popt''',
                 vars=locals())

bld.SAMBA_BINARY('locktest2',
                 source=LOCKTEST2_SRC,
                 deps='''talloc tdb tevent cap resolv libwbclient PARAM KRBCLIENT LIBSMB LIB_NONSMBD
                 ASN1_UTIL LIBTSOCKET NDR_SAMR NDR_LSA LOCKING''',
                 vars=locals())

bld.SAMBA_BINARY('debug2html',
                 source=DEBUG2HTML_SRC,
                 deps='''talloc popt''',
                 vars=locals())

bld.SAMBA_BINARY('smbfilter',
                 source=SMBFILTER_SRC,
                 deps='''talloc tevent cap resolv libwbclient PARAM LIBSMB LIB_NONSMBD KRBCLIENT ASN1_UTIL LIBTSOCKET
                 NDR_SAMR NDR_LSA''',
                 vars=locals())

bld.SAMBA_BINARY('versiontest',
                 source='lib/version_test.c ${VERSION_SRC}',
                 vars=locals())

bld.SAMBA_BINARY('wbinfo',
                 source=WBINFO_SRC,
                 deps='''talloc libwbclient tevent cap
                 NSS_WRAPPER ASN1_UTIL LIBTSOCKET PASSDB ldap PARAM LIB_NONSMBD
                 LIBSAMBA POPT_SAMBA LIBAFS_SETTOKEN''',
                 vars=locals())

bld.SAMBA_BINARY('ntlm_auth',
                 source=NTLM_AUTH_SRC,
                 deps='''tdb talloc cap resolv krb5 k5crypto com_err libwbclient PARAM LIB_NONSMBD
                 LIBS LIBSAMBA POPT_SAMBA ASN1_UTIL LIBTSOCKET
                 PASSDB GROUPDB SMBLDAP WBCOMMON LIBINIPARSER LIBADS_SERVER
                 NDR_SAMR NDR_LSA''',
                 vars=locals())

bld.SAMBA_BINARY('timelimit',
                 source='script/tests/timelimit.c',
                 vars=locals())

bld.SAMBA_BINARY('rpc_open_tcp',
                 source=RPC_OPEN_TCP_SRC,
                 deps='''talloc tdb tevent resolv cap libwbclient KRBCLIENT PARAM LIBS LIBSMB LIB_NONSMBD
                 LIBSMB_ERR ASN1_UTIL LIBTSOCKET LIBMSRPC_GEN LIBMSRPC''',
                 vars=locals())

bld.SAMBA_BINARY('test_lp_load',
                 source=TEST_LP_LOAD_SRC,
                 deps='''talloc tdb tevent cap libwbclient PARAM LIB_NONSMBD POPT_SAMBA LIBSAMBA''',
                 vars=locals())

bld.SAMBA_BINARY('dbwrap_tool',
                 source=DBWRAP_TOOL_SRC,
                 deps='''talloc tdb tevent cap PARAM LIB_NONSMBD LIBSMB_ERR''',
                 vars=locals())

bld.SAMBA_BINARY('dbwrap_torture',
                 source=DBWRAP_TORTURE_SRC,
                 deps='''talloc tdb tevent cap PARAM LIB_NONSMBD LIBSMB_ERR
                 POPT_SAMBA''',
                 vars=locals())

bld.SAMBA_BINARY('split_tokens',
                 source=SPLIT_TOKENS_SRC,
                 deps='''talloc tdb tevent cap libwbclient PARAM LIB_NONSMBD POPT_SAMBA
                 LIBSAMBA''',
                 vars=locals())

swat_files=recursive_dirlist('../swat', '../swat', '*')
bld.INSTALL_FILES('${SWATDIR}', swat_files, base_name='../swat')

########################## INCLUDES #################################

bld.RECURSE('../lib/socket_wrapper')
bld.RECURSE('../lib/talloc')
bld.RECURSE('../lib/tdb')
bld.RECURSE('../lib/nss_wrapper')
bld.RECURSE('../lib/tevent')
bld.RECURSE('../lib/popt')
bld.RECURSE('../lib/zlib')
bld.RECURSE('../lib/tsocket')
bld.RECURSE('../lib/iniparser/src')
bld.RECURSE('../lib/crypto')
bld.RECURSE('modules')
bld.RECURSE('auth')
bld.RECURSE('passdb')

bld.ENFORCE_GROUP_ORDERING()
bld.CHECK_PROJECT_RULES()
