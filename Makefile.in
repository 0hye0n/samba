# $Id$

SHELL = /bin/sh

srcdir = @srcdir@
VPATH  = @srcdir@

CC = @CC@
DEFS = @DEFS@  -I$(srcdir) -Iasn1 -I. -I/usr/athena/include
YACC = @YACC@

.SUFFIXES: .pro

CFLAGS = -g

LIBS = -L/usr/athena/lib -ldes

SOURCES = cache.c principal.c principal_p.c data.c context.c misc.c \
	  krbhst.c get_port.c send_to_kdc.c str2key.c \
	  get_in_tkt.c get_in_tkt_pw.c constants.c get_addrs.c \
	  get_cred.c

OBJECTS = $(SOURCES:%.c=%.o) config_file.o

all: kinit klist

.c.o:
	$(CC) $(CFLAGS) $(DEFS) -c $< -o $@

.c.pro:
	gcc $(CFLAGS) $(DEFS) -S -o /dev/null -aux-info $*.X $<
	awk -V f=$< -f $(srcdir)/format.awk $*.X > $@
	rm $*.X


kinit: kinit.o libkrb5.a
	$(CC) -o kinit kinit.o libkrb5.a -Lasn1 -lasn1 $(LIBS)

klist: klist.o libkrb5.a
	$(CC) -o klist klist.o libkrb5.a $(LIBS)

tt: test.o libkrb5.a
	$(CC) -o tt test.o libkrb5.a

test.o: krb5.h

libkrb5.a: $(OBJECTS)
	ar cr libkrb5.a $(OBJECTS)
	ranlib libkrb5.a 

config_file.o: config_file.c

config_file.c: config_file.y
	$(YACC) -p __k5cf_ $<
	mv -f y.tab.c config_file.c

clean:
	rm -f *.o *~ libkrb5.a tt core \#* config_file.c



$(OBJECTS): krb5_locl.h krb5.h

