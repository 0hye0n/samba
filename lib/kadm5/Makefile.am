# $Id$

AUTOMAKE_OPTIONS = no-dependencies foreign

INCLUDES = $(WFLAGS)
##INCLUDES = -I$(top_builddir)/include

COMPILE_ET = ../com_err/compile_et

lib_LIBRARIES = libkadm5srv.a libkadm5clnt.a

noinst_PROGRAMS = dump_log replay_log

incdir = $(includedir)/kadm5
idir = $(top_builddir)/include/kadm5
inc_DATA = kadm5_err.h

COMMON_SOURCES =				\
	acl.c					\
	chpass_c.c				\
	chpass_s.c				\
	common_glue.c				\
	context_s.c				\
	create_c.c				\
	create_s.c				\
	delete_c.c				\
	delete_s.c				\
	destroy_c.c				\
	destroy_s.c				\
	ent_setup.c				\
	error.c					\
	flush.c					\
	free.c					\
	get_c.c					\
	get_princs_c.c				\
	get_princs_s.c				\
	get_s.c					\
	init_c.c				\
	init_s.c				\
	kadm5_err.c				\
	log.c					\
	marshall.c				\
	modify_c.c				\
	modify_s.c				\
	privs_c.c				\
	privs_s.c				\
	randkey_c.c				\
	randkey_s.c				\
	rename_c.c				\
	rename_s.c				\
	send_recv.c				\
	server.c				\
	set_keys.c				\
	set_modifier.c
	
libkadm5srv_a_SOURCES = $(COMMON_SOURCES) server_glue.c
libkadm5clnt_a_SOURCES = $(COMMON_SOURCES) client_glue.c

dump_log_SOURCES = dump_log.c

dump_log_LDADD = libkadm5srv.a -L$(top_builddir)/lib/hdb -lhdb -L$(top_builddir)/lib/krb5 -lkrb5 -L$(top_builddir)/lib/asn1 -lasn1 -L$(top_builddir)/lib/des -ldes -L$(top_builddir)/lib/roken -lroken

replay_log_SOURCES = replay_log.c

replay_log_LDADD = libkadm5srv.a -L$(top_builddir)/lib/hdb -lhdb -L$(top_builddir)/lib/krb5 -lkrb5 -L$(top_builddir)/lib/asn1 -lasn1 -L$(top_builddir)/lib/des -ldes -L$(top_builddir)/lib/roken -lroken

CLEANFILES = kadm5_err.c kadm5_err.h

SUFFIXES = .et .h

all-local: $(inc_DATA)
	@for i in $(inc_DATA); do \
		if cmp -s  $$i $(idir)/$$i 2> /dev/null ; then :; else\
			echo " $(INSTALL_DATA) $$i $(idir)/$$i"; \
			$(INSTALL_DATA) $$i $(idir)/$$i; \
		fi ; \
	done

.et.h:
	$(COMPILE_ET) $<

.et.c:
	$(COMPILE_ET) $<

$(libkadm5srv_a_OBJECTS): kadm5_err.h

client_glue.o server_glue.o: $(srcdir)/common_glue.c
