CC = @CC@
prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
includedir = @includedir@
libdir = @libdir@
VPATH = @srcdir@
srcdir = @srcdir@
builddir = @builddir@
INSTALL = @INSTALL@

CFLAGS=-I. -I$(srcdir) @CFLAGS@

OBJS = dlfcn.o getpass.o replace.o snprintf.o

all: libreplace.a testsuite

install: all
	mkdir -p $(libdir)
	$(INSTALL) libreplace.a $(libdir)

libreplace.a: $(OBJS)
	ar -rv $@ $(OBJS)
	@-ranlib $@

test: testsuite
	./testsuite

installcheck: install test

TEST_OBJS = test/testsuite.o

testsuite: libreplace.a $(TEST_OBJS)
	$(CC) -o testsuite $(TEST_OBJS) -L. -lreplace

.c.o:
	@echo Compiling $*.c
	@mkdir -p `dirname $@`
	@$(CC) $(CFLAGS) -c $< -o $@

clean:
	rm -f *.o test/*.o *.a testsuite

distclean: clean
	rm -f *~ */*~
	rm -rf autom4te.cache
	rm -f configure \
		config.log config.status \
		replace_config.h
	rm -f Makefile
