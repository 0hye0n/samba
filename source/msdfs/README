Setting up MS Dfs in Samba
kalele@veritas.com March 2000

Currently, MS Dfs support is a configure time parameter (--with-msdfs). Can be changed later to always compile it in..

To have a server announce itself as a Dfs server, add a "host msdfs=yes" entry to smb.conf.

To make a share a Dfs root, add a "dfs map" entry to the share definition in the smb.conf file.
e.g. 
[pub]
	dfs map = /usr/local/samba/lib/pub_dfs_map

The pub_dfs_map file would contain a list of junction points and their referral paths. 

In our example, if you have a directory pub_dir1/ in the pub share and want to make it a dfs junction point to \\machineX\pub, you can have an entry in the pub_dfs_map file as:

pub_dir1
\\machineX\pub:0:600

where: 0 is the proximity of the server. If you have multiple referred servers for one junction point, you can set up preferences among these using this field.
& 600 is the number of seconds the client must cache the referral. After this time period, the smb client supposedly should contact the server again for a fresh referral.

NOTE: You can have multiple referral paths for one junction point. Currently, the parser code depends on the leading \ to determine if the line is a referral or a new junction point.

Shares with no "dfs map" entries are served as normal shares and the client stops talking Dfs with Samba after a tconX.

TODO: Dynamically showing junction points to dfs clients alone,probably in the findfirst reply. Currently, you need to have directories on the samba server as token junction points.
